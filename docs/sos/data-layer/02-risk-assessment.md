# 数据层 — 风险评估

---

## 总体风险等级：极高

数据层 P0 错误具有 **cascade 传播性**。由于 MSS/IRS/PAS 三大算法全部以 L2 快照为输入，数据层的逻辑错误会 1:N 扩散到下游所有模块。

---

## 逐项风险分析

### DATA-P0-1：rise/fall 计算口径（极高风险）

- **业务影响**: MSS 温度计算依赖 rise_ratio（上涨家数占比），口径错误导致温度读数系统性偏移。在跳空行情频繁的市场环境中（如政策面消息驱动），偏移幅度可达 10-15%。
- **技术风险**: 低。修复逻辑清晰：切换到 `pct_chg` 字段。
- **修复前置**: DATA-P1-2（SimulatedTuShareClient 补字段）

### DATA-P0-2：strong_up/down 阈值（高风险）

- **业务影响**: 大涨/大跌家数是 MSS 极端情绪指标的输入。阈值从 5% 降为 3% 会导致"大涨/大跌"被严重高估——3% 涨跌在 A 股属于正常波动。
- **技术风险**: 极低。单行改数字。
- **修复前置**: DATA-P0-1（需先修正基数）

### DATA-P0-3：touched_limit_up 遗漏炸板（高风险）

- **业务影响**: 炸板是重要的情绪信号（资金分歧）。遗漏 Z 类型后，touched_limit_up 低估真实的涨停触及数，MSS 对资金分歧的捕捉能力下降。
- **技术风险**: 低。需与 DATA-P1-3（limit 字段名）一起修。
- **修复前置**: DATA-P1-3

### DATA-P0-4：amount_volatility 语义错误（极高风险）

- **业务影响**: 成交额波动率是判断资金活跃度的核心指标。横截面标准差衡量的是"各股票间成交额的离散程度"，与设计要求的"今天成交额相对近期均值的偏离"完全是两回事。
- **技术风险**: 中。需要读取 20 日历史 market_snapshot，有冷启动问题。
- **修复前置**: 无

### DATA-P0-5：行业估值聚合（极高风险）

- **业务影响**: PE/PB 是 IRS 行业评分的直接输入。使用 mean 替代 median 对极端值极其敏感——一只 PE=5000 的亏损股可以把整个行业的 PE 拉高数倍。无 Winsorize 雪上加霜。
- **技术风险**: 中。需实现 4 步聚合 + 前值查询。
- **修复前置**: 无

### DATA-P1-1：8 个 stub=0 字段（中风险）

- **业务影响**: 这些字段目前在下游算法中引用有限，但设计明确要求它们。连续涨停指标（continuous_limit_up）和百日新高指标是趋势识别的重要输入。
- **技术风险**: 中-高。100 日历史数据需要数据积累，冷启动期无法计算。
- **修复前置**: DATA-P0-1（pre_close），历史数据积累

### DATA-P1-2：SimulatedTuShareClient 缺字段（高风险）

- **业务影响**: 直接阻断 P0-1 的修复验证。如果模拟环境不提供 pct_chg，修复后的代码无法在开发环境测试。
- **技术风险**: 低。添加 3 个计算字段。
- **修复前置**: 无（应最先修）

### DATA-P1-3：limit vs limit_type（极高生产风险）

- **业务影响**: **这是一颗定时炸弹**。模拟环境一切正常，一旦切换真实 TuShare 数据源，涨跌停统计瞬间归零。所有依赖涨跌停的指标全部失效。
- **技术风险**: 低。统一字段名。
- **修复前置**: 无

### DATA-P1-4：cal_date vs trade_date（低风险）

- **业务影响**: 不影响功能。代码通过 normalize 处理了。
- **技术风险**: 无。更新设计文档即可。
- **修复前置**: 无

### DATA-P1-5：多出字段（无风险）

- **业务影响**: 正面——style_bucket 为 IRS 提供了设计未覆盖的风格分类能力。
- **技术风险**: 无。反向补入设计文档。
- **修复前置**: 无

### DATA-P2-1 ~ P2-4（低风险）

- 路径差异和结构差异不影响计算正确性
- P2-3（trade_cal 单日拉取）浪费 API 配额但不影响结果
- P2-4（模块路径）在 OOP 重建时自然解决

---

## 风险优先级排序

修复应按以下顺序执行：

1. **DATA-P1-2** — 补 SimulatedTuShareClient 字段（前置依赖，5 分钟）
2. **DATA-P1-3** — 统一 limit 字段名（生产炸弹，10 分钟）
3. **DATA-P0-1** — 修正 rise/fall 计算口径（核心错误）
4. **DATA-P0-2** — 修正 strong_up/down 阈值（1 分钟，与 P0-1 一起做）
5. **DATA-P0-3** — 补 touched_limit_up 的 Z 统计（与 P1-3 一起做）
6. **DATA-P0-5** — 重写行业估值聚合
7. **DATA-P0-4** — 实现 amount_volatility 时间序列偏离率
8. **DATA-P1-1** — 实现 8 个 stub=0 字段（分两阶段）
9. **P1-4, P1-5, P2-*** — 文档对齐与结构优化

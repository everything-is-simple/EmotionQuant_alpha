# ENH-04/05 å¥‘çº¦æµ‹è¯•ä¸é‡‘ä¸é›€æ•°æ®åŒ… â€” è®¾è®¡ vs ä»£ç å·®å¼‚æŠ¥å‘Š

**ä¸¥é‡åº¦**: ğŸŸ¡ ä¸­ç­‰ï¼ˆENH-04 ç›®å½•ç»“æ„ï¼‰+ ğŸ”´ ä¸¥é‡ï¼ˆENH-05 é‡‘ä¸é›€ parquet ç¼ºå¤±ï¼‰
**æ¶‰åŠè®¾è®¡**: `enhancement-selection-analysis` Â§2 ENH-04/ENH-05
**æ¶‰åŠä»£ç **: `tests/` ç›®å½•ã€`tests/fixtures/`ã€`src/data/fetcher.py`

---

## Part A: ENH-04 é€‚é…å±‚å¥‘çº¦æµ‹è¯•

### A.1 ğŸŸ¡ ç›®å½•ç»“æ„åå·®

| ç»´åº¦ | è®¾è®¡è§„æ ¼ | å®é™…ä»£ç  |
|------|---------|---------|
| æµ‹è¯•ç›®å½• | `tests/contracts/` | `tests/unit/` ä¸‹å„å­ç›®å½• |
| é‡‘ä¸é›€æµ‹è¯•ç›®å½• | `tests/canary/` | ä¸å­˜åœ¨ |

**è¯¦æƒ…**: è®¾è®¡æ˜ç¡®è¦æ±‚å¥‘çº¦æµ‹è¯•æ”¾åœ¨ `tests/contracts/` ç›®å½•ä¸‹ï¼Œé‡‘ä¸é›€æµ‹è¯•æ”¾åœ¨ `tests/canary/` ç›®å½•ä¸‹ã€‚å®é™…ä»£ç ä¸­è¿™ä¸¤ä¸ªç›®å½•éƒ½ä¸å­˜åœ¨ï¼Œæ‰€æœ‰æµ‹è¯•ç»Ÿä¸€æ”¾åœ¨ `tests/unit/` ä¸‹çš„å­ç›®å½•ã€‚

---

### A.2 âœ… å¥‘çº¦æµ‹è¯•å®é™…è¦†ç›–æƒ…å†µ

è®¾è®¡è¦æ±‚ 7 ç»„å¥‘çº¦æµ‹è¯•ï¼Œé€ä¸€æ£€æŸ¥å®é™…è¦†ç›–ï¼š

| å¥‘çº¦ç»„ | è®¾è®¡é˜¶æ®µ | å®é™…æ–‡ä»¶ | çŠ¶æ€ |
|--------|---------|---------|------|
| Data Layer | S0 | `tests/unit/data/test_l1_repository_contract.py`, `test_snapshot_contract.py`, `test_fetcher_contract.py` ç­‰ 10+ æ–‡ä»¶ | âœ… æœ‰ |
| MSS | S1 | `tests/unit/integration/test_mss_integration_contract.py` | âœ… æœ‰ |
| IRS | S2 | é€šè¿‡ `test_full_chain_contract.py` é—´æ¥è¦†ç›– | ğŸŸ¡ é—´æ¥ |
| PAS | S2 | é€šè¿‡ `test_full_chain_contract.py` é—´æ¥è¦†ç›– | ğŸŸ¡ é—´æ¥ |
| Validation | S2 | `tests/unit/integration/test_validation_gate_contract.py`, `test_validation_weight_plan_bridge.py` | âœ… æœ‰ |
| Validationâ†’Integration | S2 | `tests/unit/backtest/test_validation_integration_bridge.py` | âœ… æœ‰ |
| Integration | S2 | `tests/unit/integration/test_integration_contract.py` | âœ… æœ‰ |
| Backtestâ†’Trading | S4 | `tests/unit/trading/test_order_pipeline_contract.py`, `test_position_lifecycle_contract.py` | âœ… æœ‰ |

**ç»“è®º**: å¥‘çº¦æµ‹è¯•å†…å®¹åŸºæœ¬å®Œæ•´ï¼Œä½†ç›®å½•ç»„ç»‡æ–¹å¼ä¸è®¾è®¡ä¸åŒ¹é…ã€‚

---

### A.3 å»ºè®®

| ç¼–å· | åŠ¨ä½œ | æ–¹å‘ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| R04-1 | è®¾è®¡æ–‡æ¡£ä¿®è®¢ç›®å½•ç»“æ„ä¸º `tests/unit/` ä½“ç³»ï¼ˆå·²æˆäº‹å®ï¼‰ | ä¿®è®¢è®¾è®¡ | P2 |
| R04-2 | æˆ–åˆ›å»º `tests/contracts/` ç¬¦å·é“¾æ¥/åˆ«åç›®å½•æ˜ å°„åˆ° `tests/unit/` å¯¹åº”ä½ç½® | ä¿®è®¢ä»£ç  | P3ï¼ˆå¯é€‰ï¼‰ |
| R04-3 | IRS/PAS ç‹¬ç«‹å¥‘çº¦æµ‹è¯•æ–‡ä»¶è¡¥é½ï¼ˆå½“å‰ä»…é—´æ¥è¦†ç›–ï¼‰ | ä¿®è®¢ä»£ç  | P2 |

---

## Part B: ENH-05 é‡‘ä¸é›€æ•°æ®åŒ…

### B.1 ğŸ”´ é‡‘ä¸é›€ parquet æ•°æ®åŒ…å®Œå…¨ç¼ºå¤±

| ç»´åº¦ | è®¾è®¡è§„æ ¼ | å®é™…ä»£ç  |
|------|---------|---------|
| æ•°æ®åŒ…ç›®å½• | `tests/fixtures/canary_10d/` | ä¸å­˜åœ¨ |
| Parquet æ•°æ® | 10 ä¸ªäº¤æ˜“æ—¥ Ã— 8 ç±»è¡¨ Ã— 50-100 åªè‚¡ç¥¨ | ä¸å­˜åœ¨ |
| æ•°æ®è¡¨ç±»å‹ | daily, daily_basic, limit_list, index_daily, trade_cal, stock_basic, index_member, index_classify | ä»…æœ‰ä¸€ä¸ª JSONï¼ˆäº¤æ˜“æ—¥å†ï¼‰ |

**å®é™…å­˜åœ¨**: `tests/fixtures/canary/a_share_open_trade_days_20260102_20260213.json`ï¼ˆä»…äº¤æ˜“æ—¥å† JSONï¼Œ30 å¤©äº¤æ˜“æ—¥åˆ—è¡¨ï¼‰

---

### B.2 ğŸŸ¡ æ›¿ä»£å®ç°æ–¹æ¡ˆï¼šSimulatedTuShareClient

| ç»´åº¦ | è®¾è®¡æ–¹æ¡ˆ | å®é™…æ–¹æ¡ˆ |
|------|---------|---------|
| ç¦»çº¿æµ‹è¯•æ•°æ®æ¥æº | æ–‡ä»¶ fixturesï¼ˆparquetï¼‰ | å†…å­˜ç”Ÿæˆï¼ˆ`SimulatedTuShareClient`ï¼‰ |
| æ•°æ®ç¡®å®šæ€§ | âœ… æ–‡ä»¶å›ºå®š | âœ… ä»£ç å›ºå®šï¼ˆç¡¬ç¼–ç æ¨¡æ‹Ÿæ•°æ®ï¼‰ |
| è¦†ç›–çš„ API | 8 ç±»è¡¨ | 8 ç±»è¡¨å…¨è¦†ç›– âœ… |
| æ•°æ®é‡ | 50-100 åªè‚¡ç¥¨ | 31 åªæ¨¡æ‹Ÿè‚¡ç¥¨ |
| å¯å¤ç°æ€§ | âœ… æ–‡ä»¶å†…å®¹ä¸å˜ | âœ… ä»£ç é€»è¾‘å›ºå®š |
| SW31 è¡Œä¸šæ˜ å°„ | âœ… é€šè¿‡ index_member/index_classify parquet | âœ… `_sw31_pairs()` å†…å­˜ç”Ÿæˆ 31 å¯¹ |

**è¯¦æƒ…**: `SimulatedTuShareClient` åœ¨ `src/data/fetcher.py` ä¸­å®ç°ï¼Œä¸º daily/daily_basic/trade_cal/limit_list/index_daily/index_member/index_classify/stock_basic å…¨éƒ¨ 8 ä¸ª API æä¾›äº†ç¡®å®šæ€§æ¨¡æ‹Ÿæ•°æ®ã€‚å½“ Config æ—  token æ—¶è‡ªåŠ¨å¯ç”¨ã€‚

---

### B.3 æ ¸å¿ƒé—®é¢˜

è®¾è®¡æ„å›¾æ˜¯è®©æµ‹è¯•**å®Œå…¨è„±ç¦»ä»£ç é€»è¾‘**â€”â€”parquet æ–‡ä»¶ä¸€æ—¦ç”Ÿæˆå°±ä¸å˜ï¼Œä»£ç æ€ä¹ˆæ”¹éƒ½ä¸å½±å“æµ‹è¯•æ•°æ®ã€‚è€Œ `SimulatedTuShareClient` çš„æ•°æ®ç”Ÿæˆé€»è¾‘åµŒå…¥åœ¨è¢«æµ‹ä»£ç ä¸­ï¼Œå­˜åœ¨"ä»£ç æ”¹äº†ï¼Œæ¨¡æ‹Ÿæ•°æ®ä¹Ÿè·Ÿç€å˜"çš„é£é™©ã€‚

---

### B.4 å»ºè®®

| ç¼–å· | åŠ¨ä½œ | æ–¹å‘ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| R05-1 | ç”Ÿæˆ `tests/fixtures/canary_10d/` ä¸‹çš„ parquet æ•°æ®åŒ…ï¼ˆä» SimulatedTuShareClient å¯¼å‡ºå›ºåŒ–ï¼‰ | ä¿®è®¢ä»£ç  | P1 |
| R05-2 | å®ç° `--source mock` è·¯å¾„ä» parquet fixtures è¯»å– | ä¿®è®¢ä»£ç  | P2 |
| R05-3 | è®¾è®¡æ–‡æ¡£ä¸­è¡¥å…… `SimulatedTuShareClient` ä½œä¸ºç¬¬äºŒç¦»çº¿æ–¹æ¡ˆï¼ˆå†…å­˜æ¨¡æ‹Ÿ + æ–‡ä»¶ fixtures åŒè½¨ï¼‰ | ä¿®è®¢è®¾è®¡ | P2 |

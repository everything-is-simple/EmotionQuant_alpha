# ç›®å½•ç»“æ„ä¸å‘½åè§„èŒƒ â€” è®¾è®¡ vs ä»£ç å·®å¼‚æŠ¥å‘Š

**ä¸¥é‡åº¦**: ğŸŸ¡ ä¸­ç­‰
**æ¶‰åŠè®¾è®¡**: `eq-improvement-plan-core-frozen` Â§3 å…è®¸å˜æ›´èŒƒå›´ã€`enhancement-selection-analysis` Â§å†»ç»“è¾¹ç•Œå£°æ˜ã€`README.md` Â§5.1 å¤–æŒ‚å…è®¸æ“ä½œç›®å½•
**æ¶‰åŠä»£ç **: é¡¹ç›®æ•´ä½“ç›®å½•ç»“æ„

---

## 1. è®¾è®¡æŒ‡å®šç›®å½• vs å®é™…å­˜åœ¨

### 1.1 å¤–æŒ‚å…è®¸æ“ä½œçš„ç›®å½•

è®¾è®¡æ–‡æ¡£ï¼ˆ`README.md` Â§5.1 + `eq-improvement-plan-core-frozen` Â§3ï¼‰æ˜ç¡®æŒ‡å®šå¤–æŒ‚å…è®¸æ“ä½œçš„ç›®å½•ï¼š

| è®¾è®¡æŒ‡å®šç›®å½• | å®é™…å­˜åœ¨ | å·®å¼‚ |
|-------------|---------|------|
| `src/pipeline/` | âœ… å­˜åœ¨ | â€” |
| `src/adapters/` | âŒ **ä¸å­˜åœ¨** | ğŸŸ¡ é€‚é…å™¨åœ¨ `src/data/adapters/` |
| `tests/contracts/` | âŒ **ä¸å­˜åœ¨** | ğŸŸ¡ å¥‘çº¦æµ‹è¯•åœ¨ `tests/unit/` |
| `tests/canary/` | âŒ **ä¸å­˜åœ¨** | ğŸŸ¡ é‡‘ä¸é›€æ–‡ä»¶åœ¨ `tests/fixtures/canary/` |
| `scripts/quality/` | âœ… å­˜åœ¨ | â€” |
| `src/data/` | âœ… å­˜åœ¨ | â€” |
| `src/backtest/` | âœ… å­˜åœ¨ | â€” |
| `src/trading/` | âœ… å­˜åœ¨ | â€” |
| `src/gui/` | âœ… å­˜åœ¨ | â€” |

---

### 1.2 `src/adapters/` ç¼ºå¤±è¯¦æƒ…

| ç»´åº¦ | è®¾è®¡é¢„æœŸ | å®é™…ä½ç½® |
|------|---------|---------|
| Qlib é€‚é…å™¨ | `src/adapters/qlib_adapter.py` | **å®Œå…¨ä¸å­˜åœ¨** |
| AKShare é€‚é…å™¨ | `src/adapters/` ç›®å½•ä¸‹ | `src/data/adapters/akshare_adapter.py` |
| BaoStock é€‚é…å™¨ | `src/adapters/` ç›®å½•ä¸‹ | `src/data/adapters/baostock_adapter.py` |

**é—®é¢˜**: è®¾è®¡å°† `src/adapters/` ä½œä¸ºé¡¶çº§é€‚é…å±‚ç›®å½•ï¼ˆä¸ `src/pipeline/` å¹³çº§ï¼‰ï¼Œç”¨äºæ•°æ®/å›æµ‹/äº¤æ˜“/å±•ç¤ºçš„è–„é€‚é…ã€‚å®é™…åªæœ‰æ•°æ®é€‚é…å™¨å­˜åœ¨ï¼Œä¸”æ”¾åœ¨äº† `src/data/adapters/` å­ç›®å½•ä¸‹ã€‚

---

### 1.3 `tests/contracts/` å’Œ `tests/canary/` ç¼ºå¤±è¯¦æƒ…

| è®¾è®¡ç›®å½• | å®é™…æ˜ å°„ | æ–‡ä»¶æ•°é‡ |
|---------|---------|---------|
| `tests/contracts/test_data_*` | `tests/unit/data/test_*_contract.py` | ~10 ä¸ª |
| `tests/contracts/test_mss_*` | `tests/unit/integration/test_mss_*_contract.py` | ~2 ä¸ª |
| `tests/contracts/test_irs_*` | æ— ç‹¬ç«‹æ–‡ä»¶ | 0ï¼ˆé—´æ¥è¦†ç›–ï¼‰ |
| `tests/contracts/test_pas_*` | æ— ç‹¬ç«‹æ–‡ä»¶ | 0ï¼ˆé—´æ¥è¦†ç›–ï¼‰ |
| `tests/contracts/test_validation_*` | `tests/unit/integration/test_validation_*_contract.py` | ~2 ä¸ª |
| `tests/contracts/test_integration_*` | `tests/unit/integration/test_integration_contract.py` | 1 ä¸ª |
| `tests/contracts/test_backtest_*` | `tests/unit/backtest/test_backtest_contract.py` ç­‰ | ~7 ä¸ª |
| `tests/contracts/test_trading_*` | `tests/unit/trading/test_*_contract.py` | ~4 ä¸ª |
| `tests/contracts/test_gui_*` | `tests/unit/gui/test_*_contract.py` | ~6 ä¸ª |
| `tests/contracts/test_scheduler_*` | `tests/unit/pipeline/test_scheduler_*_contract.py` | ~3 ä¸ª |
| `tests/canary/` | `tests/fixtures/canary/` | 1 ä¸ª JSON |

---

## 2. ä»£ç ä¸­å­˜åœ¨ä½†è®¾è®¡æœªæåŠçš„ç›®å½•

| ç›®å½• | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `src/stress/` | å‹åŠ›æµ‹è¯•æ¨¡å— | è®¾è®¡æœªæ˜ç¡®æåŠ |
| `src/analysis/` | æ”¶ç›Šå½’å› åˆ†æ | è®¾è®¡æœªä½œä¸ºç‹¬ç«‹æ¨¡å—åˆ—å‡º |
| `src/models/` | æšä¸¾å®šä¹‰ | è®¾è®¡æœªæ˜ç¡®æåŠ |
| `src/db/` | DuckDB å¸®åŠ©å‡½æ•° | è®¾è®¡æœªæ˜ç¡®æåŠ |
| `src/integration/` | é›†æˆæ¨èæ¨¡å— | è®¾è®¡æåŠä½†æœªåˆ—å…¥å…è®¸å˜æ›´ç›®å½• |
| `src/algorithms/` | æ ¸å¿ƒç®—æ³•å®ç° | è®¾è®¡ä½œä¸ºå†»ç»“åŒºï¼Œä¸å…è®¸å¤–æŒ‚ä¿®æ”¹ |

---

## 3. ENH CLI å‘½ä»¤å‘½åå¯¹ç…§

è®¾è®¡æ–‡æ¡£ä¸­çš„å»ºè®®å‘½ä»¤ vs å®é™… CLI å‘½ä»¤ï¼š

| è®¾è®¡å»ºè®® | å®é™…å®ç° | å·®å¼‚ |
|---------|---------|------|
| `eq run --date {date} --source tushare` | `eq run --date {date} --source tushare` | âœ… ä¸€è‡´ |
| `eq mss --date {date}` | `eq mss --date {date}` | âœ… ä¸€è‡´ |
| `eq recommend --date {date}` | `eq recommend --date {date} --mode {mode}` | ğŸŸ¡ å¤šäº†å¿…å¡« `--mode` |
| `eq backtest --engine qlib --start --end` | `eq backtest --engine qlib --start --end` | âœ… ä¸€è‡´ |
| `eq trade --mode paper --date {date}` | `eq trade --mode paper --date {date}` | âœ… ä¸€è‡´ |
| `eq gui --date {date}` | `eq gui --date {date}` | âœ… ä¸€è‡´ |
| `eq run-all --start --end` | `eq run-all --date {date}` | ğŸŸ¡ è®¾è®¡è¦ start/endï¼Œå®é™…åªæœ‰ date |
| `eq fetch-batch --start --end --batch-size 365 --workers 3` | `eq fetch-batch --start --end --batch-size 30 --workers 3` | ğŸŸ¡ é»˜è®¤ batch-size ä¸åŒ |
| `eq scheduler install` | `eq scheduler install` | âœ… ä¸€è‡´ |
| `eq scheduler status` | `eq scheduler status` | âœ… ä¸€è‡´ |
| `eq scheduler run-once` | `eq scheduler run-once --date {date}` | âœ… ä¸€è‡´ |
| `pytest tests/canary tests/contracts/test_data_* -q` | ä¸é€‚ç”¨ï¼ˆè·¯å¾„ä¸å­˜åœ¨ï¼‰ | ğŸŸ¡ æµ‹è¯•è·¯å¾„ä¸åŒ¹é… |

---

## 4. å»ºè®®ä¿®è®¢æ–¹æ¡ˆ

| ç¼–å· | åŠ¨ä½œ | æ–¹å‘ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| R-DIR-1 | è®¾è®¡æ–‡æ¡£æ›´æ–°ç›®å½•åˆ—è¡¨ï¼š`src/adapters/` â†’ `src/data/adapters/` | ä¿®è®¢è®¾è®¡ | P1 |
| R-DIR-2 | è®¾è®¡æ–‡æ¡£æ›´æ–°æµ‹è¯•ç›®å½•ï¼š`tests/contracts/` â†’ `tests/unit/`ã€`tests/canary/` â†’ `tests/fixtures/canary/` | ä¿®è®¢è®¾è®¡ | P1 |
| R-DIR-3 | `eq recommend` çš„ `--mode` ä¸ºå®é™…å¿…å¡«ä½†è®¾è®¡æœªæåŠï¼Œéœ€å›å†™ | ä¿®è®¢è®¾è®¡ | P2 |
| R-DIR-4 | `eq run-all` å‚æ•°ä» `--start/--end` æ”¹ä¸º `--date` çš„å·®å¼‚éœ€ç¡®è®¤è®¾è®¡æ„å›¾ | åŒå‘è®¨è®º | P2 |
| R-DIR-5 | è®¾è®¡æ–‡æ¡£ pytest å‘½ä»¤ä¸­çš„æµ‹è¯•è·¯å¾„éœ€æ›´æ–°ä¸ºå®é™…è·¯å¾„ | ä¿®è®¢è®¾è®¡ | P1 |
| R-DIR-6 | è¡¥å…… `src/stress/`ã€`src/analysis/`ã€`src/integration/` åˆ°å…è®¸å˜æ›´èŒƒå›´ï¼ˆå·²æ˜¯äº‹å®ï¼‰ | ä¿®è®¢è®¾è®¡ | P2 |

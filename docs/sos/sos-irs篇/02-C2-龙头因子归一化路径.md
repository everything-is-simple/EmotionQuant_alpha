# C2 ğŸ”´ é¾™å¤´å› å­å½’ä¸€åŒ–è·¯å¾„ä¸ä¸€è‡´

## é—®é¢˜å®šä½

- **è®¾è®¡æ–‡ä»¶**: `docs/design/core-algorithms/irs/irs-algorithm.md` Â§3.5 (line 238-239)
- **ä»£ç æ–‡ä»¶**: `src/algorithms/irs/pipeline.py` (line 503-538)
- **ä»£ç æ–‡ä»¶**: `src/algorithms/irs/calculator.py` (line 194-230)

## å·®å¼‚æè¿°

### è®¾è®¡è§„å®šï¼ˆå…ˆzååˆï¼Œæ— æœ€ç»ˆzï¼‰

```
leader_avg_pct = Mean(top5_pct_chg)
leader_limit_up_ratio = top5_limit_up / 5
leader_score = 0.6 Ã— normalize_zscore(leader_avg_pct)
             + 0.4 Ã— normalize_zscore(leader_limit_up_ratio)
```

æ‰§è¡Œæ­¥éª¤ï¼š
1. å¯¹ leader_avg_pct åš z-score â†’ 0-100
2. å¯¹ leader_limit_up_ratio åš z-score â†’ 0-100
3. åŠ æƒç»„åˆ â†’ leader_scoreï¼ˆç›´æ¥å°±æ˜¯æœ€ç»ˆåˆ†æ•°ï¼Œ0-100 èŒƒå›´ï¼‰

æ³¨æ„ï¼šè®¾è®¡ä¸­ leader_score **æ²¡æœ‰**æœ€ç»ˆçš„ normalize_zscore åŒ…è£¹ã€‚

### ä»£ç å®ç°ï¼ˆå…ˆåˆåzï¼‰

```python
# pipeline.py:503-506
leader_raw_series = 0.6 * top5_pct_avg + 0.4 * top5_limit_ratio
leader_raw = float(leader_raw_series.iloc[-1])
# ...
leader_score, ... = _score_with_history(value=leader_raw, ...)
```

æ‰§è¡Œæ­¥éª¤ï¼š
1. åŸå§‹ leader_avg_pct å’Œ leader_limit_up_ratio æŒ‰ 0.6/0.4 åŠ æƒæ±‚å’Œ
2. å¯¹ç»„åˆç»“æœåšä¸€æ¬¡ z-score â†’ leader_score

## ä¸ºä»€ä¹ˆè¿™æ˜¯è‡´å‘½é—®é¢˜

ä¸ C1 åŒç†ä½†æ›´éšè”½ï¼š
- `top5_pct_chg` å‡å€¼çš„å…¸å‹èŒƒå›´ï¼š-10% ~ +10%ï¼ˆé‡çº§ 0.01~0.1ï¼‰
- `top5_limit_up / 5` çš„èŒƒå›´ï¼š0, 0.2, 0.4, 0.6, 0.8, 1.0ï¼ˆç¦»æ•£å€¼ï¼‰

ä¸¤è€…é‡çº²ä¸åŒã€‚ä»£ç çš„"å…ˆåˆåz"è®© leader_limit_up_ratio çš„ç¦»æ•£è·³å˜ä¸»å¯¼äº†ç»„åˆå€¼çš„åˆ†å¸ƒå½¢æ€ï¼Œæ¶¨å¹…å‡å€¼çš„è¿ç»­ä¿¡å·è¢«ç¨€é‡Šã€‚

è®¾è®¡çš„"å…ˆzååˆ"ç¡®ä¿ä¸¤ä¸ªå­å› å­åœ¨åŒä¸€ 0-100 å°ºåº¦åå†ç»„åˆï¼Œ0.6/0.4 çš„æƒé‡æ‰æœ‰æ„ä¹‰ã€‚

## æ–¹æ¡ˆé€‰é¡¹

### æ–¹æ¡ˆ Aï¼šä»£ç å‘è®¾è®¡å¯¹é½ï¼ˆæ¨è âœ…ï¼‰

```python
# æ›¿æ¢ pipeline.py:503-538 ä¸­çš„é€»è¾‘

# å¯¹ä¸¤ä¸ªå­å› å­å„è‡ª z-score
leader_pct_score, _, _ = _score_with_history(
    value=float(top5_pct_avg.iloc[-1]),
    history_series=top5_pct_avg,
    baseline_map=baseline_map,
    baseline_key="irs_leader_pct_avg",
)
leader_limit_score, _, _ = _score_with_history(
    value=float(top5_limit_ratio.iloc[-1]),
    history_series=top5_limit_ratio,
    baseline_map=baseline_map,
    baseline_key="irs_leader_limit_ratio",
)
# åŠ æƒç»„åˆä½œä¸ºæœ€ç»ˆ leader_scoreï¼ˆä¸å†åšæœ€ç»ˆ z-scoreï¼‰
leader_score = 0.6 * leader_pct_score + 0.4 * leader_limit_score
```

**æ³¨æ„**ï¼šè®¾è®¡ä¸­ leader_score æ— æœ€ç»ˆ z-score åŒ…è£¹ã€‚
ç»„åˆç»“æœå·²åœ¨ 0-100 èŒƒå›´å†…ï¼ˆä¸¤ä¸ª 0-100 åˆ†æ•°çš„å‡¸ç»„åˆä»åœ¨ 0-100 å†…ï¼‰ï¼Œ
æ— éœ€å†åšå½’ä¸€åŒ–ã€‚

**å½±å“**ï¼š
- éœ€è¦æ–°å¢ baseline_key `irs_leader_pct_avg` å’Œ `irs_leader_limit_ratio`
- leader_raw çš„å®šä¹‰éœ€è¦ç›¸åº”è°ƒæ•´ï¼ˆfactor_intermediate è¡¨ä¸­è®°å½•ä»€ä¹ˆä½œä¸º rawï¼‰
- è¯„åˆ†ç»“æœä¼šå‘ç”Ÿå˜åŒ–

### æ–¹æ¡ˆ Bï¼šè®¾è®¡å‘ä»£ç å¯¹é½

ä¿®æ”¹è®¾è®¡ä¸ºï¼š
```
leader_raw = 0.6 Ã— leader_avg_pct + 0.4 Ã— leader_limit_up_ratio
leader_score = normalize_zscore(leader_raw)
```

**é—®é¢˜**ï¼šåŒ C1ï¼Œé‡çº²å·®å¼‚è®©æƒé‡å¤±æ•ˆã€‚

**ä¸æ¨è** âŒ

## ä¸ C1 çš„å…³ç³»

C1ï¼ˆä¼°å€¼ï¼‰å’Œ C2ï¼ˆé¾™å¤´ï¼‰æ˜¯åŒä¸€ç±»é—®é¢˜â€”â€”å¤šå­å› å­åˆæˆæ—¶çš„å½’ä¸€åŒ–è·¯å¾„åˆ†æ­§ã€‚
å»ºè®® **ä¸€èµ·å†³ç­–ã€ä¸€èµ·ä¿®å¤**ï¼Œä¿æŒå…­å› å­ä½“ç³»å†…çš„å½’ä¸€åŒ–ç­–ç•¥ä¸€è‡´æ€§ã€‚

## å»ºè®®

é€‰æ‹© **æ–¹æ¡ˆ A**ï¼Œä»£ç å‘è®¾è®¡å¯¹é½ã€‚

# M1 ğŸŸ  åŸºå› åº“å› å­æ•°æ®æºè¯­ä¹‰åå·®

## é—®é¢˜å®šä½

- **è®¾è®¡æ–‡ä»¶**: `docs/design/core-algorithms/irs/irs-algorithm.md` Â§3.6 (line 254-268)
- **æ•°æ®æ¨¡å‹**: `docs/design/core-algorithms/irs/irs-data-models.md` Â§1.2 (line 33)
- **ä»£ç æ–‡ä»¶**: `src/algorithms/irs/pipeline.py` (line 508-514)

## å·®å¼‚æè¿°

### è®¾è®¡è§„å®š

```
æ•°æ®æ¥æºï¼šraw_daily + raw_limit_list
å‚æ•°ï¼š
- history_limit_up_count: å†å²æ¶¨åœè‚¡æ•°é‡ï¼ˆ3å¹´æ»šåŠ¨ï¼‰
- history_new_high_count: å†å²æ–°é«˜è‚¡æ•°é‡ï¼ˆ3å¹´æ»šåŠ¨ï¼‰

å…¬å¼ï¼š
history_limit_up_ratio = history_limit_up_count / stock_count
history_new_high_ratio = history_new_high_count / stock_count
gene_raw = 0.6 Ã— time_decay(history_limit_up_ratio, decay=0.9)
         + 0.4 Ã— time_decay(history_new_high_ratio, decay=0.9)
```

è®¾è®¡æ„å›¾ï¼š
- ä» raw_daily + raw_limit_list ä¸­ç»Ÿè®¡**3å¹´æ»šåŠ¨çª—å£å†…**çš„ç´¯è®¡æ¶¨åœ/æ–°é«˜è‚¡æ•°
- ç®—å‡ºæ¯”ç‡ååš time_decay

### ä»£ç å®ç°

```python
# pipeline.py:508-514
gene_limit_ratio = pd.to_numeric(
    industry_hist["limit_up_count"], errors="coerce"
).fillna(0.0) / stock_count

gene_high_ratio = pd.to_numeric(
    industry_hist["new_100d_high_count"], errors="coerce"
).fillna(0.0) / stock_count

gene_raw_series = (
    0.6 * gene_limit_ratio.ewm(alpha=0.1, adjust=False).mean()
    + 0.4 * gene_high_ratio.ewm(alpha=0.1, adjust=False).mean()
)
```

ä»£ç é€»è¾‘ï¼š
- ä½¿ç”¨ `limit_up_count`ï¼ˆindustry_snapshot ä¸­çš„**å½“æ—¥**æ¶¨åœè‚¡æ•°ï¼‰
- ä½¿ç”¨ `new_100d_high_count`ï¼ˆindustry_snapshot ä¸­çš„**å½“æ—¥**100æ—¥æ–°é«˜è‚¡æ•°ï¼‰
- ç®—å‡ºæ¯æ—¥ ratioï¼Œç„¶åå¯¹æ•´ä¸ªå†å²åºåˆ—åš EWMï¼ˆalpha=0.1 â†” decay=0.9ï¼‰

## è¯­ä¹‰å·®å¼‚åˆ†æ

| ç»´åº¦ | è®¾è®¡ | ä»£ç  |
|------|------|------|
| å­—æ®µå | `history_limit_up_count`ï¼ˆ3å¹´ç´¯è®¡ï¼‰ | `limit_up_count`ï¼ˆå½“æ—¥æ•°ï¼‰ |
| å­—æ®µå | `history_new_high_count`ï¼ˆ3å¹´ç´¯è®¡ï¼‰ | `new_100d_high_count`ï¼ˆå½“æ—¥æ•°ï¼‰ |
| æ•°æ®æº | raw_daily + raw_limit_list | industry_snapshotï¼ˆL2èšåˆå±‚ï¼‰ |
| ratio å«ä¹‰ | ç´¯è®¡æ¶¨åœæ•° / è‚¡ç¥¨æ•° | å½“æ—¥æ¶¨åœæ•° / è‚¡ç¥¨æ•° |
| time_decay | å¯¹ ratio åš decay | å¯¹æ¯æ—¥ ratio åºåˆ—åš EWM |

### æ•ˆæœå·®å¼‚

**è®¾è®¡è·¯å¾„**ï¼šå…ˆç´¯è®¡3å¹´â†’å¾—åˆ°ä¸€ä¸ª"å†å²æ€»é‡"â†’é™¤ä»¥è‚¡ç¥¨æ•°â†’decay
â†’ åˆ»ç”»çš„æ˜¯è¡Œä¸š**å†å²æƒ¯æ€§**ï¼ˆè¿™ä¸ªè¡Œä¸šè¿‡å»3å¹´å‡ºäº†å¤šå°‘æ¶¨åœ/æ–°é«˜è‚¡ï¼‰

**ä»£ç è·¯å¾„**ï¼šæ¯å¤©çš„æ¶¨åœ/æ–°é«˜æ•°é‡â†’é™¤ä»¥è‚¡ç¥¨æ•°â†’EWM è¡°å‡å¹³å‡
â†’ åˆ»ç”»çš„æ˜¯è¡Œä¸š**è¿‘æœŸæƒ¯æ€§**ï¼ˆæ›´åé‡è¿‘æœŸæ—¥åº¦çš„æ¶¨åœ/æ–°é«˜é¢‘ç‡ï¼‰

ä¸¤è€…åœ¨ç‰›å¸‚ä¸­å¯èƒ½æ¥è¿‘ï¼Œä½†åœ¨ç†Šå¸‚/éœ‡è¡å¸‚ä¸­å·®å¼‚æ˜¾è‘—ï¼š
- ä¸€ä¸ªæ›¾ç»å¼ºåŠ¿ä½†è¿‘æœŸæ²‰å¯‚çš„è¡Œä¸šï¼Œè®¾è®¡è·¯å¾„ä¼šç»™è¾ƒé«˜åˆ†ï¼ˆå› ä¸º3å¹´ç´¯è®¡æƒ¯æ€§è¿˜åœ¨ï¼‰
- ä»£ç è·¯å¾„ä¼šå¿«é€Ÿè¡°å‡ï¼ˆå› ä¸ºè¿‘æœŸæ²¡æœ‰æ¶¨åœ/æ–°é«˜ï¼‰

## æ–¹æ¡ˆé€‰é¡¹

### æ–¹æ¡ˆ Aï¼šä»£ç å‘è®¾è®¡å¯¹é½

ä» raw_daily + raw_limit_list ç»Ÿè®¡3å¹´æ»šåŠ¨çª—å£å†…çš„ç´¯è®¡æ¶¨åœ/æ–°é«˜æ•°ã€‚

**é—®é¢˜**ï¼š
- pipeline.py å½“å‰åªä» industry_snapshot è¯»æ•°æ®ï¼Œæ²¡æœ‰ç›´æ¥è¯» raw_daily/raw_limit_list
- å¼•å…¥åŸå§‹è¡¨è¯»å–ä¼šæ˜¾è‘—å¢åŠ  pipeline å¤æ‚åº¦å’Œè®¡ç®—æ—¶é—´
- industry_snapshot æ˜¯ L2 å±‚ï¼Œpipeline åº”è¯¥æ¶ˆè´¹ L2 è€Œéå›é€€åˆ° L1

**ä¸æ¨èç”¨äºå½“å‰é˜¶æ®µ** âš ï¸

### æ–¹æ¡ˆ Bï¼šè®¾è®¡å‘ä»£ç å¯¹é½ï¼ˆæ¨è âœ…ï¼‰

ä¿®æ”¹è®¾è®¡ Â§3.6ï¼Œæ˜ç¡®åŸºå› åº“å› å­ä½¿ç”¨ **industry_snapshot ä¸­çš„æ—¥åº¦æ¶¨åœ/æ–°é«˜è®¡æ•° + EWM è¡°å‡**ï¼š

```
ä¿®è®¢å…¬å¼ï¼š
daily_limit_up_ratio = limit_up_count / stock_count      # æ¥è‡ª industry_snapshot
daily_new_high_ratio = new_100d_high_count / stock_count  # æ¥è‡ª industry_snapshot
gene_raw = 0.6 Ã— EWM(daily_limit_up_ratio, decay=0.9)
         + 0.4 Ã— EWM(daily_new_high_ratio, decay=0.9)
gene_score = normalize_zscore(gene_raw)

æ•°æ®æ¥æºï¼šindustry_snapshotï¼ˆL2ï¼‰
```

ç†ç”±ï¼š
1. ä»£ç çš„"æ—¥åº¦ ratio + EWM"æ–¹æ¡ˆåœ¨ MVP é˜¶æ®µæ›´å®é™…
2. ä¸ pipeline ç°æœ‰æ•°æ®ä¾èµ–ä¸€è‡´ï¼ˆåªæ¶ˆè´¹ L2 industry_snapshotï¼‰
3. EWM(decay=0.9) ä»èƒ½ä½“ç°å†å²æƒ¯æ€§ï¼ˆåŠè¡°æœŸçº¦ 6.6 ä¸ªäº¤æ˜“æ—¥ï¼‰ï¼Œå¯¹äºçŸ­ä¸­æœŸè½®åŠ¨è¶³å¤Ÿ
4. å¦‚æœæœªæ¥éœ€è¦"3å¹´é•¿æœŸæƒ¯æ€§"ï¼Œå¯ä»¥ä½œä¸ºå¢å¼ºç‰ˆæœ¬å¦è¡Œå®ç°

### æ–¹æ¡ˆ Cï¼šåœ¨ industry_snapshot ä¸­é¢„è®¡ç®—3å¹´ç´¯è®¡å­—æ®µ

åœ¨ L2 èšåˆå±‚å¢åŠ  `history_limit_up_count_3y` å’Œ `history_new_high_count_3y` å­—æ®µï¼Œ
ç”± snapshot aggregator ä» raw å±‚é¢„è®¡ç®—ã€‚

**ä¼˜ç‚¹**ï¼šå…¼é¡¾è®¾è®¡æ„å›¾å’Œ pipeline æ•°æ®ä¾èµ–è§„èŒƒ
**ç¼ºç‚¹**ï¼šéœ€è¦ä¿®æ”¹ snapshot aggregatorï¼ˆæ•°æ®å±‚ä»£ç ï¼‰ï¼Œè¶…å‡ºæœ¬æ¬¡æ€¥æ•‘èŒƒå›´

**å¯çº³å…¥åç»­è¿­ä»£** â³

## å»ºè®®

å½“å‰é€‰æ‹© **æ–¹æ¡ˆ B**ï¼ˆè®¾è®¡å‘ä»£ç å¯¹é½ï¼‰ï¼ŒåŒæ—¶åœ¨è®¾è®¡ä¸­æ ‡æ³¨"åç»­å¯å‡çº§ä¸ºæ–¹æ¡ˆ C"ã€‚

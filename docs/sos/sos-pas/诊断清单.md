# PAS è®¾è®¡ vs ä»£ç  â€” åå·®è¯Šæ–­æ¸…å•

**å®¡è®¡åŸºçº¿**: è®¾è®¡ v3.2.0 (2026-02-14) vs `src/algorithms/pas/pipeline.py`
**å®¡è®¡æ—¥æœŸ**: 2026-02-27

---

## ğŸ”´ P0 â€” ç®—æ³•è¯­ä¹‰åå·®ï¼ˆ8é¡¹ï¼‰

### P0-01 ç‰›è‚¡åŸºå› å› å­ï¼šå­æƒé‡ä¸ä¸€è‡´

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.1):
```
bull_gene_raw = 0.4Ã—limit_up_120d_ratio
              + 0.3Ã—new_high_60d_ratio
              + 0.3Ã—max_pct_chg_history_ratio
```

**ä»£ç å®é™…** (`pipeline.py:292`):
```python
wbg = 0.4 * wlur + 0.4 * wnhr + 0.2 * wmaxpct
```

**åå·®æœ¬è´¨**:
- `new_high_60d_ratio` æƒé‡: è®¾è®¡ 0.3 â†’ ä»£ç  0.4
- `max_pct_chg_history_ratio` æƒé‡: è®¾è®¡ 0.3 â†’ ä»£ç  0.2
- `limit_up_120d_ratio` æƒé‡ 0.4 ä¸€è‡´

**å½±å“**: ç‰›è‚¡åŸºå› å› å­å¯¹ã€Œåˆ›æ–°é«˜é¢‘ç‡ã€èµ‹äºˆäº†æ›´é«˜æƒé‡ï¼Œå¯¹ã€Œå†å²æœ€å¤§æ¶¨å¹…ã€èµ‹äºˆäº†æ›´ä½æƒé‡ã€‚è¯„åˆ†åˆ†å¸ƒå°†åå‘ç¨³å®šåˆ›æ–°é«˜çš„æ ‡çš„ï¼Œè€Œéçˆ†å‘åŠ›å¼ºçš„æ ‡çš„ã€‚

---

### P0-02 ç‰›è‚¡åŸºå› å› å­ï¼šmax_pct_chg_history è®¡ç®—æ–¹å¼å®Œå…¨ä¸åŒ

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.1):
```
max_pct_chg_history_ratio = max_pct_chg_history / 100
```
- è¾“å…¥: `max_pct_chg_history` å­—æ®µï¼Œç™¾åˆ†æ•°å£å¾„ï¼ˆ15 è¡¨ç¤º 15%ï¼‰
- å¤„ç†: é™¤ä»¥ 100 å¾—åˆ° ratioï¼ˆ0.15ï¼‰
- æ•°æ®æ¥æº: `raw_daily` å†å²çª—å£å†… `max(pct_chg)`

**ä»£ç å®é™…** (`pipeline.py:289-291`):
```python
wpcp = wpct.clip(lower=0.0)
wmaxpct = (wpcp.rolling(120, min_periods=1).max() / 0.30).clip(0.0, 1.0)
```
- è¾“å…¥: `wpct = wc.pct_change()` â€” æ—¥æ”¶ç›Šç‡ ratioï¼ˆ0.10 è¡¨ç¤º 10%ï¼‰
- å¤„ç†: å– 120 æ—¥æ»šåŠ¨æœ€å¤§æ­£æ—¥æ”¶ç›Šç‡ï¼Œé™¤ä»¥ 0.30ï¼ˆ30% ä¸ºå¤©èŠ±æ¿ï¼‰ï¼Œclip åˆ° [0,1]
- æ—  `max_pct_chg_history` å­—æ®µæ¦‚å¿µ

**åå·®æœ¬è´¨**:
1. é‡çº²ä¸åŒ: è®¾è®¡ç”¨ç™¾åˆ†æ•°å­—æ®µ /100ï¼Œä»£ç ç”¨ pct_change ratio /0.30
2. å½’ä¸€åŒ–å¤©èŠ±æ¿ä¸åŒ: è®¾è®¡æ— å¤©èŠ±æ¿ï¼ˆratio å¯è¶… 1ï¼‰ï¼Œä»£ç ä»¥ 30% ä¸ºæ»¡åˆ†
3. æ•°æ®æ¥æºä¸åŒ: è®¾è®¡æœŸæœ›ç‹¬ç«‹å­—æ®µ `max_pct_chg_history`ï¼ˆå¯èƒ½è¦†ç›–å…¨å†å²ï¼‰ï¼Œä»£ç ä»…çœ‹è¿‘ 120 æ—¥

**å½±å“**: å¯¹å†å²æœ€å¤§æ¶¨å¹… >30% çš„çˆ†å‘è‚¡ï¼ˆå¦‚æ¶¨åœæ¿è¿ç»­çš„æ ‡çš„ï¼‰ï¼Œä»£ç è¯„åˆ†è¢«æˆªæ–­ä¸ºæ»¡åˆ†ï¼Œä¸§å¤±åŒºåˆ†åº¦ã€‚

---

### P0-03 ç»“æ„ä½ç½®å› å­ï¼šå…¬å¼ä¸‰è¦ç´ ç¼ºä¸€ï¼Œæƒé‡å…¨æ”¹

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.2):
```
structure_raw = 0.4Ã—price_position
              + 0.3Ã—trend_continuity_ratio
              + 0.3Ã—breakout_strength
```

**ä»£ç å®é™…** (`pipeline.py:306-311`):
```python
for _w in (20, 60, 120):
    _pos = ((wc - _wwl) / _rng).clip(0.0, 1.0)
    w_str[_w] = 0.7 * _pos + 0.3 * _wbsn
```

**åå·®æœ¬è´¨**:
- `trend_continuity_ratio` **å®Œå…¨ç¼ºå¤±**ï¼ˆ0.3 æƒé‡è’¸å‘ï¼‰
- `price_position` æƒé‡: è®¾è®¡ 0.4 â†’ ä»£ç  0.7
- `breakout_strength` æƒé‡: è®¾è®¡ 0.3 â†’ ä»£ç  0.3ï¼ˆä¸€è‡´ï¼Œä½†å½’ä¸€åŒ–æ–¹å¼ä¸åŒï¼Œè§ P0-08ï¼‰

**å½±å“**: ç»“æ„å› å­å®Œå…¨ä¸§å¤±ã€Œè¶‹åŠ¿å»¶ç»­æ€§ã€ç»´åº¦ã€‚ä¸€ä¸ªä»·æ ¼å¤„äºåŒºé—´é«˜ä½ä½†è¿ç»­ä¸Šæ¶¨å¤©æ•°ä¸º 0 çš„è‚¡ç¥¨ï¼Œä¸è¿ç»­ä¸Šæ¶¨ 5 å¤©çš„è‚¡ç¥¨è·å¾—ç›¸åŒçš„ç»“æ„è¯„åˆ†ã€‚

---

### P0-04 trend_continuity_ratio é”™è¯¯å½’å±ï¼ˆç»“æ„å› å­ â†’ è¡Œä¸ºå› å­ï¼‰

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§2.4 å®è§‚æ–¹å‘å½’å±è¡¨):
```
ç»“æ„ä½ç½®/çªç ´: price_position, trend_continuity_ratio, breakout_strength
è¡Œä¸ºç¡®è®¤/é‡ä»·: volume_quality, pct_chg, limit_up_flag
```

**ä»£ç å®é™…** (`pipeline.py:435-436`):
```python
_trend_comp = np.clip(_cu_arr / np.maximum(_tw_arr.astype(float), 1.0), 0.0, 1.0)
_beh_raw = 0.4 * _vq + 0.4 * _pc + 0.2 * _trend_comp
```
`trend_comp` è¢«æ”¾å…¥äº†**è¡Œä¸ºå› å­**ã€‚

**åå·®æœ¬è´¨**: è¿åè®¾è®¡ Â§2.4 å®è§‚æ–¹å‘äº’æ–¥å½’å±è§„åˆ™ï¼Œç ´åå› å­è¯­ä¹‰æ­£äº¤æ€§ã€‚è¡Œä¸ºå› å­æœ¬åº”åæ˜ ã€Œé‡ä»·é…åˆã€ï¼Œå´æ··å…¥äº†è¶‹åŠ¿å»¶ç»­ä¿¡å·ã€‚

---

### P0-05 è¡Œä¸ºç¡®è®¤å› å­ï¼šç»„ä»¶å’Œæƒé‡å…¨éƒ¨ä¸åŒ

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.3):
```
behavior_raw = 0.4Ã—volume_quality + 0.3Ã—pct_chg_norm + 0.3Ã—limit_up_flag
```

**ä»£ç å®é™…** (`pipeline.py:435-436`):
```python
_beh_raw = 0.4 * _vq + 0.4 * _pc + 0.2 * _trend_comp
```

**åå·®å¯¹ç…§**:

| ç»´åº¦ | è®¾è®¡ | ä»£ç  | åå·® |
|------|------|------|------|
| ç¬¬ 1 ç»„ä»¶ | volume_quality (å¤åˆ) | ç®€åŒ– vol_ratio | ç»„ä»¶ç®€åŒ–ï¼ˆè§ P0-06ï¼‰ |
| ç¬¬ 1 æƒé‡ | 0.4 | 0.4 | ä¸€è‡´ |
| ç¬¬ 2 ç»„ä»¶ | pct_chg_norm (æ—¥é—´Â±20%) | æ—¥å†…æ”¶ç›Šç‡ (Â±10%) | å£å¾„+èŒƒå›´å‡ä¸åŒ |
| ç¬¬ 2 æƒé‡ | 0.3 | 0.4 | +0.1 |
| ç¬¬ 3 ç»„ä»¶ | limit_up_flag (æ¶¨åœ/ç‚¸æ¿) | trend_comp (è¿æ¶¨å¤©æ•°) | **å®Œå…¨æ›¿æ¢** |
| ç¬¬ 3 æƒé‡ | 0.3 | 0.2 | -0.1 |

**å½±å“**: æ¶¨åœ/ç‚¸æ¿ä¿¡å·ï¼ˆè®¾è®¡ä¸­ 30% æƒé‡çš„æ ¸å¿ƒç¡®è®¤ä¿¡å·ï¼‰å®Œå…¨æ¶ˆå¤±ï¼›æ¶¨è·Œå¹…æ˜ å°„èŒƒå›´ç¼©çª„å¯¼è‡´åˆ›ä¸šæ¿/ç§‘åˆ›æ¿ >10% æ¶¨å¹…å‡é¥±å’Œã€‚

---

### P0-06 volume_quality è®¡ç®—è¢«å¤§å¹…ç®€åŒ–

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.3):
```
volume_quality = clip(
    0.60Ã—clip(volume_ratio / 3.0, 0, 1)
  + 0.25Ã—turnover_norm
  + 0.15Ã—intraday_retention, 0, 1)
```
ä¸‰ä¸ªå­ç»„ä»¶: é‡æ¯”å½’ä¸€åŒ–(60%) + æ¢æ‰‹ç‡å½’ä¸€åŒ–(25%) + æ”¶ç›˜ä¿çœŸåº¦(15%)

**ä»£ç å®é™…** (`pipeline.py:314-315`):
```python
wvq = (wv / _wva_safe).clip(0.0, 2.0) / 2.0
```

**ç¼ºå¤±å­ç»„ä»¶**:
- âŒ `turnover_norm` = clip(turnover_rate / 12.0, 0, 1) â€” æ¢æ‰‹ç‡å½’ä¸€åŒ–
- âŒ `intraday_retention` = clip((close - low) / max(high - low, Îµ), 0, 1) â€” æ”¶ç›˜ä¿çœŸåº¦

**å½±å“é“¾æ¡**: volume_quality é€€åŒ–ä¸ºç®€å•é‡æ¯” â†’ è¡Œä¸ºå› å­è´¨é‡ä¸‹é™ â†’ `liquidity_discount = clip(volume_quality, 0.50, 1.00)` ä¹Ÿä½¿ç”¨ç®€åŒ–å€¼ â†’ æœ‰æ•ˆé£é™©æ”¶ç›Šæ¯”æŠ˜æ‰£ä¸å‡†ã€‚

---

### P0-07 çªç ´å‚è€ƒä»·ä¸éšè‡ªé€‚åº”çª—å£å˜åŒ–

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.2):
```
(range_high, range_low, breakout_ref) = choose_by_window(adaptive_window)
  - 20d  -> (high_20d,  low_20d,  high_20d_prev)
  - 60d  -> (high_60d,  low_60d,  high_60d_prev)
  - 120d -> (high_120d, low_120d, high_120d_prev)
```

**ä»£ç å®é™…** (`pipeline.py:295-300`):
```python
wh20p = whs1.rolling(20, min_periods=1).max()
wh60p = whs1.rolling(60, min_periods=1).max()
_wbr = np.maximum(wh20p.values, wh60p.values)
```

**åå·®**:
1. å§‹ç»ˆå– `max(high_20d_prev, high_60d_prev)`ï¼Œä¸åŒºåˆ†å½“å‰è‡ªé€‚åº”çª—å£
2. **ä»æœªè®¡ç®— `high_120d_prev`** â€” å½“ adaptive_window=120 æ—¶ç¼ºå°‘å¯¹åº”å‚è€ƒä»·
3. breakout_ref ä¸éšçª—å£åˆ‡æ¢ï¼Œç ´åäº†è‡ªé€‚åº”æœºåˆ¶çš„å®Œæ•´æ€§

**å½±å“**: ä½æ³¢åŠ¨æ ‡çš„ï¼ˆåº”ä½¿ç”¨ 120 æ—¥çª—å£ï¼‰çš„çªç ´åˆ¤æ–­ä»åŸºäºçŸ­æœŸå‰é«˜ï¼Œçªç ´ä¿¡å·è¿‡äºæ•æ„Ÿã€‚

---

### P0-08 çªç ´å¼ºåº¦å½’ä¸€åŒ–æ–¹å¼ä¸åŒ

**è®¾è®¡åŸæ–‡** (`pas-algorithm.md` Â§3.2):
```
breakout_strength = (close - breakout_ref) / max(breakout_ref, Îµ)
```

**ä»£ç å®é™…** (`pipeline.py:302-303`):
```python
_wbsn = (((wc - _wbr_s) / _wbr_abs).clip(-0.2, 0.2) + 0.2) / 0.4
_wbsn = _wbsn.clip(0.0, 1.0)
```

**åå·®**: å¢åŠ  clip(-0.2, 0.2) + çº¿æ€§æ˜ å°„åˆ° [0,1]ã€‚çªç ´å¹…åº¦ >20% åé¥±å’Œï¼Œè´Ÿçªç ´ä¹Ÿè·å¾—æ­£å€¼ï¼ˆæœ€ä½ 0 è€Œéè´Ÿæ•°ï¼‰ã€‚

**å½±å“**: å¤§å¹…çªç ´çš„åŒºåˆ†åº¦è¢«æˆªæ–­ï¼Œè®¾è®¡ä¸­ breakout_strength å¯ä¸ºè´Ÿï¼ˆè·Œç ´å‰é«˜ï¼‰ï¼Œè¿›å…¥ zscore åè‡ªç„¶åæ˜ æ–¹å‘ã€‚

---

## ğŸŸ  P1 â€” æ•°æ®æºç¼ºå¤±ï¼ˆ2é¡¹ï¼‰

### P1-01 raw_daily_basic æœªè¯»å– â€” turnover_rate ç”¨ç²—ç•¥è¿‘ä¼¼

**è®¾è®¡**: `turnover_rate` æ¥è‡ª `raw_daily_basic` è¡¨ï¼ˆçœŸå®æ¢æ‰‹ç‡ = æˆäº¤é‡/æµé€šè‚¡æœ¬Ã—100%ï¼‰

**ä»£ç ** (`pipeline.py:408`):
```python
_tr = _amount / np.maximum(_close * 10000.0, 1.0)
```
ç”¨ `amount/(closeÃ—10000)` è¿‘ä¼¼ï¼Œç‰©ç†å«ä¹‰ä¸æ˜ï¼Œä¸”æœªè€ƒè™‘æµé€šè‚¡æœ¬å·®å¼‚ã€‚å¤§ç›˜è‚¡è¢«ç³»ç»Ÿæ€§ä½ä¼°æ¢æ‰‹ç‡ï¼Œå°ç›˜è‚¡è¢«é«˜ä¼°ã€‚

**å½±å“**: è‡ªé€‚åº”çª—å£é€‰æ‹©ï¼ˆä¾èµ– turnover_rate é˜ˆå€¼ 3.0/8.0ï¼‰äº§ç”Ÿç³»ç»Ÿæ€§åå·®ã€‚

---

### P1-02 raw_limit_list æœªè¯»å– â€” æ¶¨è·ŒåœçŠ¶æ€å…¨é ä»·æ ¼æ¨æ–­

**è®¾è®¡**: `is_limit_up` / `is_touched_limit_up` / `limit_up_count_120d` æ¥è‡ª `raw_limit_list` è¡¨

**ä»£ç **: ç”¨æ—¥æ”¶ç›Šç‡é˜ˆå€¼è¿‘ä¼¼æ¶¨åœï¼Œä¸”ä¸¤å¤„åˆ¤å®šå£å¾„ä¸ä¸€è‡´ï¼š
- ç‰›è‚¡åŸºå› ç”¨ `wpct`ï¼ˆæ—¥é—´ pct_changeï¼‰
- é£é™©æŠ˜æ‰£ç”¨ `_ret_ratio`ï¼ˆæ—¥å†… (close-open)/openï¼‰
- `is_touched_limit_up`ï¼ˆç‚¸æ¿ï¼‰ä»…åœ¨é£é™©æŠ˜æ‰£å¤„è¿‘ä¼¼ï¼Œè¡Œä¸ºå› å­ä¸­å®Œå…¨ç¼ºå¤±

**å½±å“**: æ¶¨åœç»Ÿè®¡ä¸å‡† + ç‚¸æ¿è¯†åˆ«ç¼ºå¤± + ä¸¤å¤„æ¶¨åœå£å¾„ä¸ä¸€è‡´ã€‚

---

## ğŸŸ¡ P2 â€” è¾“å‡ºæ¨¡å‹åå·®ï¼ˆ3é¡¹ï¼‰

### P2-01 ä¸»è¡¨ç¼ºå°‘è®¾è®¡è¦æ±‚çš„å­—æ®µ

è®¾è®¡ `StockPasDaily` è¦æ±‚ä½†ä»£ç æœªè¾“å‡º:

| ç¼ºå¤±å­—æ®µ | ç”¨é€” |
|----------|------|
| `stock_name` | å±•ç¤ºä¸å®¡è®¡ |
| `industry_code` | IRS ååŒç­›é€‰ï¼ˆIntegration å±‚ä¾èµ–ï¼‰ |
| `entry` | å»ºè®®å…¥åœºä»· |
| `stop` | å»ºè®®æ­¢æŸä»· |
| `target` | å»ºè®®ç›®æ ‡ä»· |

ä»£ç å¤šå‡ºäº†è®¾è®¡æœªå®šä¹‰çš„åˆ«åå­—æ®µ: `pas_score`ã€`pas_direction`ã€‚

---

### P2-02 å› å­ä¸­é—´è¡¨å¤§é‡å­—æ®µç¼ºå¤±

è®¾è®¡ `pas_factor_intermediate` å®šä¹‰ 18 ä¸ªå­—æ®µï¼Œä»£ç ä»…å†™å…¥ 6 ä¸ª:

**å·²å†™å…¥**: bull_gene_raw, structure_raw, behavior_raw, volatility_20d, turnover_rate, adaptive_window

**ç¼ºå¤± 12 ä¸ª**: limit_up_count_120d, new_high_count_60d, max_pct_chg_history, price_position, consecutive_up_days, consecutive_down_days, breakout_strength, volume_ratio, volume_quality, bull_gene_mean/std, structure_mean/std, behavior_mean/std

---

### P2-03 pas_opportunity_log è¡¨æœªå®ç°

è®¾è®¡å®šä¹‰äº†ç­‰çº§å˜åŒ–æ—¥å¿—è¡¨ï¼ˆupgrade/downgrade/unchangedï¼‰ï¼Œä»£ç å®Œå…¨æœªå®ç°ã€‚ç¼ºå°‘ä¸ªè‚¡æœºä¼šç­‰çº§åŠ¨æ€å˜åŒ–çš„å†å²è½¨è¿¹ã€‚

---

## ğŸ”µ P3 â€” æ–‡æ¡£/åŸºçº¿ï¼ˆ2é¡¹ï¼‰

### P3-01 æ¨¡å— Docstring ä¸è®¾è®¡å› å­å‘½åå®Œå…¨ä¸åŒ¹é…

ä»£ç  docstring æè¿°å› å­ä¸º momentum_score/volume_score/pattern_scoreï¼Œè®¾è®¡ä¸º bull_gene/structure/behaviorã€‚å‘½åå±äºä¸åŒæ¦‚å¿µä½“ç³»ï¼Œæš´éœ²ä»£ç åŸºäºæ›´æ—©ç‰ˆæœ¬ã€‚

### P3-02 Z-Score baseline æœªæŒ‰è®¾è®¡ä½¿ç”¨ parquet æ–‡ä»¶

è®¾è®¡è¦æ±‚ä» `${DATA_PATH}/config/pas_zscore_baseline.parquet` åŠ è½½ç¦»çº¿ baseline å¹¶æŒä¹…åŒ–ç‰ˆæœ¬ã€‚ä»£ç ç›´æ¥ä»å†å² tail(120) è®¡ç®— mean/stdï¼ŒåŠŸèƒ½å¯å·¥ä½œä½†ç¼ºå°‘æŒä¹…åŒ–ä¸ç‰ˆæœ¬ç®¡ç†ã€‚

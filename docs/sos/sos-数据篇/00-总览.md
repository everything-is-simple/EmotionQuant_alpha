# SOS 急救方案总览：数据层代码与核心设计差异

**创建日期**: 2026-02-27
**状态**: 待审阅
**范围**: `src/data/` 全部代码 vs `docs/design/core-infrastructure/data-layer/` 四份设计文档

---

## 差异全景

本次审查共发现 **14 项差异**，按严重程度分为：

| 等级 | 数量 | 含义 | 对应文件 |
|------|------|------|----------|
| P0 逻辑错误 | 5 项 | 代码已实现但逻辑与设计相悖，直接影响算法正确性 | `01-P0-逻辑错误.md` |
| P1 功能/命名 | 5 项 | 缺失实现或命名不一致，存在生产隐患 | `02-P1-功能与命名.md` |
| P2 路径/结构 | 4 项 | 存储路径或模块组织偏差，不影响计算正确性 | `03-P2-路径与结构.md` |

## 修复原则

1. **代码向设计对齐** — 设计文档经过多轮 review，是权威口径；代码偏离了设计，应修正代码
2. **设计确认后再动代码** — 本方案先呈现问题和建议方向，经你确认后再执行修改
3. **分批修复、逐项验证** — 每修一项跑对应测试，不做大爆炸式重构
4. **设计文档同步更新** — 代码中发现的合理扩展（如 style_bucket）需要反向补入设计

## 影响链分析

```
L2 快照计算错误（P0 #1~#5）
    ↓
  market_snapshot / industry_snapshot 数据失真
    ↓
  MSS 温度计算 / IRS 行业评分 / PAS 基因库 全部受影响
    ↓
  integrated_recommendation 综合推荐失真
    ↓
  交易信号质量不可信
```

**结论**：P0 项如果不修复，整个算法链的输出都不可信。

## 文件清单

| 文件 | 内容 |
|------|------|
| `00-总览.md` | 本文件 |
| `01-P0-逻辑错误.md` | 5 项计算逻辑错误的详细诊断与修复方案 |
| `02-P1-功能与命名.md` | 5 项功能缺失 / 命名不一致的详细诊断与修复方案 |
| `03-P2-路径与结构.md` | 4 项存储路径 / 模块结构偏差的详细诊断与修复方案 |

# 02 — 风险评估

每项差异从三个维度评估：**业务风险**（对交易决策的影响）、**系统完整性**（对上下游链路的影响）、**债务膨胀**（放任不管的后果）。

---

## 风险矩阵总览

| GAP | 名称 | 业务风险 | 系统完整性 | 债务膨胀 | 综合 |
|-----|------|---------|-----------|---------|------|
| GAP-11 | Gate fallback 语义错误 | 🔴 极高 | 🔴 高 | 🔴 高 | **P0-紧急** |
| GAP-03 | 因子验证逻辑错位 | 🔴 极高 | 🔴 高 | 🔴 高 | **P0-紧急** |
| GAP-01 | Config 阈值偏离 | 🔴 高 | 🟡 中 | 🔴 高 | **P0-紧急** |
| GAP-04 | Regime 分类反转 | 🔴 高 | 🟡 中 | 🔴 高 | **P0-紧急** |
| GAP-05 | Regime 调整策略矛盾 | 🔴 高 | 🟡 中 | 🟡 中 | **P0-紧急** |
| GAP-06 | WFA 纸上谈兵 | 🟡 中 | 🔴 高 | 🔴 高 | **P1-高** |
| GAP-02 | 因子枚举缺失 | 🟡 中 | 🔴 高 | 🔴 高 | **P1-高** |
| GAP-12 | API 结构偏离 | 🟡 低 | 🔴 高 | 🔴 高 | **P1-高** |
| GAP-07 | Factor Report 表结构 | 🟡 低 | 🟡 中 | 🟡 中 | **P2-中** |
| GAP-08 | Weight Report 表结构 | 🟡 低 | 🟡 中 | 🟡 中 | **P2-中** |
| GAP-09 | RunManifest 结构 | 🟢 低 | 🟡 中 | 🟡 中 | **P2-中** |
| GAP-10 | WeightPlan 桥接表 | 🟡 低 | 🟡 中 | 🟡 低 | **P2-中** |
| GAP-13 | 产物路径 | 🟢 无 | 🟡 低 | 🟡 低 | **P3-低** |
| GAP-14 | Baseline 权重微偏 | 🟢 无 | 🟢 无 | 🟢 低 | **P3-低** |

---

## P0 — 紧急（直接影响交易安全或核心语义）

### GAP-11: Gate Fallback 语义错误 → 风控漏洞

**业务风险**: 🔴 极高
- 核心数据完全缺失时（MSS/IRS/PAS 全部没有），设计要求**硬阻断**（`position_cap_ratio=0.00`，不允许开仓）
- 代码只做**半降仓**（`position_cap_ratio=0.50`），即数据全无时仍允许50%仓位交易
- 这是一个**真实的风控漏洞**：在信息完全缺失的情况下仍然允许执行交易

**最坏场景**: 数据源全面故障，系统在无任何信号的情况下以50%仓位运行，造成无依据的资金暴露。

**系统影响**: Trading 层读取 `position_cap_ratio` 执行降仓，如果此值不正确，整条风控链失效。

---

### GAP-03: 因子验证逻辑错位 → 验证形同虚设

**业务风险**: 🔴 极高
- Validation 的核心使命是"验证因子是否仍有预测力"
- 代码验证的是"IRS分数和PAS分数是否相关"——这与因子预测力无关
- 一个完全失效的因子（IC=0、对未来收益无预测力）可能因为 IRS/PAS 恰好相关而通过验证
- 反之，一个有效因子可能因为 IRS/PAS 不相关而被错误拒绝

**最坏场景**: 失效因子持续入模，导致投资组合基于无效信号做出决策；或有效因子被误杀，错过盈利机会。

**系统影响**: 验证层的存在目的被根本性架空。下游（Integration/Backtest/Trading）消费的 gate 决策不可信。

---

### GAP-01: Config 阈值5倍偏差 → 门禁失灵

**业务风险**: 🔴 高
- `icir_pass` 设计=0.20，代码=1.00：几乎所有正常因子都会被判为 FAIL（ICIR≥1.0 是非常高的门槛）
- 代码的高阈值会导致**过度阻断**，使得验证门禁在正常市况下几乎永远 FAIL
- 这解释了为什么代码中有大量 fallback/softening 逻辑——因为正常阈值设置不合理

**连锁反应**: 阈值不合理 → 持续 FAIL → 持续触发 softening/fallback → Gate 失去区分 PASS/WARN/FAIL 的能力 → 验证层沦为橡皮图章。

---

### GAP-04 + GAP-05: Regime 分类反转 + 调整策略矛盾 → 阈值调反方向

**业务风险**: 🔴 高
- 设计中"热+波动"市场应放宽IC阈值（因为波动市中IC天然偏低）
- 代码中"热+稳定"市场反而收紧所有阈值
- 结果：在波动市中本该放行的信号被阻断，在安静市中本该收紧的信号被放行
- 与设计意图完全相反的风控调节

**最坏场景**: 市场剧烈波动时验证频繁阻断（本该是放宽门禁允许系统运作），市场平静时验证过于宽松（本该是收紧门禁抑制噪声）。

---

## P1 — 高（影响系统架构完整性，但短期可有临时方案）

### GAP-06: WFA 纸上谈兵

**系统完整性**: 🔴 高
- 设计承诺的 Walk-Forward Analysis 是验证权重有效性的核心手段
- 代码用启发式公式替代，无法真正比较 candidate vs baseline 的 OOS 表现
- 权重切换决策缺乏数据支撑

**短期可接受**: 如果当前阶段权重方案不会频繁更换（始终使用 baseline），则影响可控。
**长期不可接受**: 一旦需要动态调整权重方案，没有 WFA 就是盲人开车。

---

### GAP-02: 因子枚举缺失

**系统完整性**: 🔴 高
- 15个因子→数据源映射是信息流文档的核心契约
- 代码4个因子名与设计零重叠，意味着设计的因子→L2数据映射全部无法执行
- 任何依赖因子名做跨模块关联的逻辑都会断裂

**短期可接受**: 如果因子验证本身还不完整（见GAP-03），枚举缺失的影响被更大问题遮盖。

---

### GAP-12: API 结构偏离

**系统完整性**: 🔴 高
- 10个设计API未实现，下游（圈级验证、Integration桥接、审计追溯）无法按设计调用
- 但当前项目可能尚未到达需要这些API的阶段

**短期可接受**: 如果当前只跑 `run_validation_gate`，其他API暂未被调用。
**长期不可接受**: Spiral收口验证、月度深度复核、审计追溯等都依赖缺失的API。

---

## P2 — 中（表结构偏离，影响数据查询和审计）

### GAP-07/08/09/10: 五张表结构偏离

**系统影响**:
- 字段缺失意味着审计数据不完整（如缺少 `reason`, `coverage_ratio`, `vs_baseline`）
- 字段命名不一致意味着跨文档查阅需要人工翻译（`decision` vs `gate`，`candidate_id` vs `plan_id`）
- 额外字段（`contract_version`, `vote_detail` 等）本身是合理的增量改进

**评估**: 表结构偏离是可修复的（对齐命名+补齐字段），但需要协调上下游查询代码。

---

## P3 — 低（不影响核心功能）

### GAP-13: 产物路径偏离
仅影响外部工具/脚本的路径假设。可后续统一。

### GAP-14: Baseline 权重微偏
0.34/0.33/0.33 vs 1/3 三等分——差异 < 1%，实际影响可忽略。

---

## 风险传导链分析

```
GAP-01 (阈值不合理)
  └→ 正常因子持续FAIL
       └→ 触发大量softening逻辑
            └→ Gate失去区分能力
                 └→ Validation层名存实亡

GAP-03 (验证逻辑错位)
  └→ 验证结果与因子真实预测力无关
       └→ 可能放行失效因子 / 误杀有效因子
            └→ Integration收到不可靠的gate决策
                 └→ 下游交易决策基于无效验证

GAP-04+05 (Regime反转)
  └→ 阈值调整方向相反
       └→ 波动市过度阻断 / 安静市过度放行
            └→ 验证门禁与市场状态反周期

GAP-11 (Fallback语义错)
  └→ 数据全缺时仍50%仓位运行
       └→ 风控最后一道防线失效
            └→ 无信号交易 → 不可控资金暴露
```

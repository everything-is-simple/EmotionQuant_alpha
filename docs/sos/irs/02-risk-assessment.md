# IRS — 风险评估

---

## 总体风险等级：高

三项致命问题直接影响行业评分正确性，其中归一化路径问题是系统性的数学错误。

---

## 逐项风险分析

### IRS-C1：估值因子归一化（极高风险）

- **业务影响**: PE(10-100) 和 PB(1-10) 直接加权，PE 主导结果。对于 growth 行业（设计 w_pb=0.65），PB 权重虽高但绝对值小，实际效果接近 PE 独占——完全违背设计初衷。
- **技术风险**: 中。需要拆分 PE/PB 各自 z-score，新增 baseline_key，重构评分计算流。
- **修复前置**: 无

### IRS-C2：龙头因子归一化（高风险）

- **业务影响**: 涨幅均值（连续信号）被涨停比率（离散跳变）主导。0.6/0.4 权重无法反映设计意图。
- **技术风险**: 中。与 C1 同类修改。
- **修复前置**: 无（应与 C1 一起决策和修复）

### IRS-C3：calculator 硬编码权重（中风险 — 当前非主链）

- **业务影响**: calculator.py 当前非主链调用路径，不影响生产评分。但一旦切换为主链，所有行业的估值权重都是 0.5/0.5，style_bucket 差异化失效。
- **技术风险**: 低。复制 pipeline.py 的 STYLE_WEIGHTS 逻辑。
- **修复前置**: C1（需与 C1 的归一化路径修复一起做）

### IRS-M1：基因库因子数据源（中风险）

- **业务影响**: 代码的"近期惯性"在熊市中衰减快，可能过早放弃曾经强势的行业。设计的"3年累计惯性"更稳定但需要 L1 原始数据。
- **技术风险**: 高（方案A需要 pipeline 读 L1）。建议设计向代码对齐（方案B），后续升级。

### IRS-M2：market_amount_total 来源（中风险）

- **业务影响**: 分母不准确会系统性影响 flow_share 和 crowding_ratio。若包含"ALL"行，分母翻倍。
- **技术风险**: 低。优先读 snapshot 字段，汇总作兜底。

### IRS-M3：calculator quality_flag（低风险 — 当前非主链）

- **业务影响**: stale 数据被标为 normal，Integration 不会做降级处理。当前 calculator 非主链。
- **技术风险**: 极低。加一行判断。

### IRS-m1/m2（低风险）

- recommendation 字段有语义冲突隐患，但当前下游未强依赖
- docstring 错误无运行影响

---

## 风险优先级排序

1. **IRS-C1 + IRS-C2** — 一起决策、一起修复归一化路径（核心数学错误）
2. **IRS-M2** — 修 market_amount_total 来源（影响 flow_share 精度）
3. **IRS-C3 + IRS-M3** — calculator 对齐（非主链，但防止未来踩雷）
4. **IRS-M1** — 设计文档向代码对齐，标注后续可升级
5. **IRS-m1** — 移除 recommendation 或补充设计
6. **IRS-m2** — 修 docstring

# 01 模块结构差异

## 设计定义 (gui-api.md §1)

```
gui/
├── pages/                          # 7 个独立页面模块
│   ├── dashboard.py
│   ├── mss.py
│   ├── irs.py
│   ├── pas.py
│   ├── integrated.py
│   ├── trading.py
│   └── analysis.py
├── components/                     # 6 个可复用 UI 组件
│   ├── temperature_card.py
│   ├── cycle_badge.py
│   ├── industry_rank_table.py
│   ├── stock_signal_table.py
│   ├── recommendation_table.py
│   └── risk_overview.py
├── services/                       # 3 个服务层
│   ├── data_service.py
│   ├── cache_service.py
│   └── observability.py
└── utils/                          # 3 个工具模块
    ├── formatters.py
    ├── filters.py
    └── exporters.py
```

总计：4 层目录，约 19 个模块文件

## 代码现状 (src/gui/)

```
gui/
├── __init__.py
├── app.py              # 入口：export + Streamlit 启动
├── dashboard.py        # Streamlit 主入口 + 全部 7 页面渲染
├── data_service.py     # 数据服务（直连 DuckDB）
├── formatter.py        # 格式化工具
└── models.py           # 全部数据模型
```

总计：扁平结构，5 个业务文件

## 逐层差异分析

### pages/ — 完全缺失
| 设计 | 代码现状 |
|------|----------|
| 7 个独立页面模块 | 全部压缩为 dashboard.py 中 7 个 `_render_xxx()` 函数 |
| 每个页面独立 import 各自依赖 | 所有页面共享同一个文件作用域 |
| 页面间通过 DataService 解耦 | 页面间通过闭包共享 `svc` 实例 |

**影响**:
- 单页面无法独立测试
- 页面增长后 dashboard.py 将不可维护
- 无法支持设计中的"页面级懒加载"

### components/ — 完全缺失
| 设计 | 代码现状 |
|------|----------|
| 6 个可复用组件 | 无组件抽象，所有 UI 渲染内联在页面函数中 |
| TemperatureCard 等独立组件 | `st.metric()` 直接调用，无封装 |
| 组件可跨页面复用 | 每个页面重复 st.columns + st.metric 调用 |

**影响**:
- 设计中的组件化思路完全未落地
- UI 一致性难以保证
- 修改温度卡片样式需修改多处

### services/ — 部分实现
| 设计 | 代码现状 |
|------|----------|
| data_service.py | ✅ 存在（但在 gui/ 根目录，非 services/） |
| cache_service.py | ❌ 完全缺失 |
| observability.py | ❌ 完全缺失 |

### utils/ — 部分实现
| 设计 | 代码现状 |
|------|----------|
| formatters.py | ✅ 存在为 formatter.py（命名偏差 + 位置偏差） |
| filters.py | ❌ 完全缺失 |
| exporters.py | ❌ 完全缺失 |

## 急救方案选项

### 方案 A：修订设计文档适配代码（成本低，但设计降级）
- 将设计改为扁平结构描述
- 删除 components/services/utils 子目录要求
- 降级为"所有逻辑在 5 个文件中实现"

### 方案 B：重构代码适配设计（成本高，质量提升）
- 按设计创建 pages/components/services/utils 子目录
- 将 dashboard.py 中的 7 个 `_render_xxx` 拆分为独立页面模块
- 提取 UI 组件为独立 component
- 补齐 CacheService, FilterService, ExportService

### 方案 C：折中方案（推荐）
- 保持扁平结构但修订设计文档说明实际架构选择
- 在现有代码中补齐核心缺失功能（过滤逻辑、缓存机制等），不强求目录结构
- 优先补齐 P0 功能性差异，结构性差异作为 tech debt 记录

# Aè‚¡å¸‚åœºäº¤æ˜“è§„åˆ™ - TuShare Proç‰ˆ

**ç‰ˆæœ¬**: v0.01
**åˆ›å»ºæ—¶é—´**: 2024-12-19
**æ›´æ–°æ—¶é—´**: 2025-12-20
**é€‚ç”¨èŒƒå›´**: EmotionQuanté¡¹ç›® Aè‚¡äº¤æ˜“è§„åˆ™å‚è€ƒ
**æ•°æ®æº**: TuShare Pro + ä¸Šäº¤æ‰€/æ·±äº¤æ‰€/åŒ—äº¤æ‰€å®˜æ–¹è§„åˆ™
**ä¼˜å…ˆçº§**: Aè‚¡äº¤æ˜“è§„åˆ™æƒå¨å‚è€ƒï¼ˆæ’æ˜Ÿç»„æ–‡æ¡£ â­â­â­ï¼‰
**å®šä½**: å‚è€ƒèµ„æ–™ï¼ˆéè®¾è®¡è§„èŒƒï¼‰
**è·¯çº¿å›¾å£å¾„**: Spiral + CPï¼ˆå‘½å `CP-*`ï¼Œä»¥ `Governance/SpiralRoadmap/planA/VORTEX-EVOLUTION-ROADMAP.md` ä¸ºå‡†ï¼‰
**å†²çªå¤„ç†**: è‹¥ä¸ `docs/design/` å†²çªï¼Œä»¥è®¾è®¡æ–‡æ¡£ä¸ºå‡†
**æ•´ç†æ›´æ–°**: 2026-02-05ï¼ˆç³»ç»Ÿé“å¾‹è¡¨è¿°æ›´æ–°ï¼‰

---

## ğŸ†• v2.0 æ›´æ–°è¯´æ˜

### ä¸»è¦æ›´æ–°

- âœ… **2025å¹´è§„åˆ™æ ¡å‡†**: åŒæ­¥ä¸‰å¤§äº¤æ˜“æ‰€2025å¹´æœ€æ–°äº¤æ˜“è§„åˆ™

- âœ… **T+1å¢å¼º**: å®Œå–„T+1äº¤æ˜“åˆ¶åº¦çš„ç‰¹æ®Šåœºæ™¯å¤„ç†

- âœ… **æ¶¨è·Œåœä¼˜åŒ–**: æ–°å¢æ³¨å†Œåˆ¶æ¿å—å·®å¼‚åŒ–æ¶¨è·Œåœå¤„ç†

- âœ… **é›†åˆç«ä»·ç»†åŒ–**: å¢åŠ å¼€ç›˜/æ”¶ç›˜é›†åˆç«ä»·è¯¦ç»†æ—¶æ®µ

- âœ… **EmotionQuantæ·±åº¦é›†æˆ**: MSS+IRS+PASå…¨ç³»ç»Ÿé€‚é…

### ä¸v1.0å¯¹æ¯”

| åŠŸèƒ½ | v1.0 | v2.0 |
| ------ | ------ | ------ |
| äº¤æ˜“æ‰€è¦†ç›– | æ²ªæ·± | æ²ªæ·±åŒ—ï¼ˆå®Œæ•´ï¼‰ |
| æ¶¨è·Œåœè§„åˆ™ | åŸºç¡€ | æ³¨å†Œåˆ¶å·®å¼‚åŒ– |
| é›†åˆç«ä»· | ç®€å• | è¯¦ç»†æ—¶æ®µåˆ’åˆ† |
| T+1å¤„ç† | åŸºç¡€ | ç‰¹æ®Šåœºæ™¯è¦†ç›– |
| EmotionQuanté›†æˆ | MSS | MSS+IRS+PAS |

---

## ğŸ“‹ äº¤æ˜“æ‰€æ¦‚è¿°

ä¸­å›½Aè‚¡å¸‚åœºç”±ä¸‰å¤§äº¤æ˜“æ‰€ç»„æˆï¼Œæ¯ä¸ªäº¤æ˜“æ‰€éƒ½æœ‰å…¶ç‰¹å®šçš„äº¤æ˜“è§„åˆ™å’Œå¸‚åœºç‰¹è‰²ã€‚

### ä¸‰å¤§äº¤æ˜“æ‰€å¯¹æ¯” (2025å¹´æ ‡å‡†)

| äº¤æ˜“æ‰€ | ç®€ç§° | ä¸»è¦æ¿å— | æ¶¨è·Œåœé™åˆ¶ | ç‰¹è‰² |
| -------- | ------ | ---------- | ----------- | ------ |
| ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ | ä¸Šäº¤æ‰€/SSE | ä¸»æ¿ã€ç§‘åˆ›æ¿ | ä¸»æ¿Â±10%ã€ç§‘åˆ›Â±20% | å¤§ç›˜è“ç­¹ä¸ºä¸» |
| æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ | æ·±äº¤æ‰€/SZSE | ä¸»æ¿ã€åˆ›ä¸šæ¿ | ä¸»æ¿Â±10%ã€åˆ›ä¸šÂ±20% | æˆé•¿å‹ä¼ä¸š |
| åŒ—äº¬è¯åˆ¸äº¤æ˜“æ‰€ | åŒ—äº¤æ‰€/BSE | åˆ›æ–°å±‚ã€åŸºç¡€å±‚ | Â±30% | ä¸“ç²¾ç‰¹æ–° |

---

## â° äº¤æ˜“æ—¶é—´è§„åˆ™

### æ ‡å‡†äº¤æ˜“æ—¶æ®µ (v2.0è¯¦ç»†ç‰ˆ)

```python
import pandas as pd
from datetime import time
from typing import Dict, Tuple

def get_trading_sessions_v2() -> Dict:
    """
    v2.0å¢å¼ºç‰ˆï¼šè·å–Aè‚¡æ ‡å‡†äº¤æ˜“æ—¶æ®µ
    EmotionQuantä¸“ç”¨ - ç²¾ç¡®åˆ°ç§’çº§
    """

    sessions = {
        'morning_call_auction': {
            'start_time': time(9, 15, 0),
            'end_time': time(9, 25, 0),
            'duration_minutes': 10,
            'description': 'å¼€ç›˜é›†åˆç«ä»·',
            'sub_phases': {
                'order_phase': {'start': time(9, 15, 0), 'end': time(9, 20, 0), 'desc': 'å¯ç”³æŠ¥å¯æ’¤å•'},
                'frozen_phase': {'start': time(9, 20, 0), 'end': time(9, 25, 0), 'desc': 'åªèƒ½ç”³æŠ¥ä¸èƒ½æ’¤å•'},
                'match_phase': {'time': time(9, 25, 0), 'desc': 'é›†åˆç«ä»·æ’®åˆ'},
            },
            'emotion_significance': 'â­â­â­â­â­ å¼€ç›˜æƒ…ç»ªæœ€å…³é”®æ—¶æ®µ'
        },
        'morning_continuous': {
            'start_time': time(9, 30, 0),
            'end_time': time(11, 30, 0),
            'duration_minutes': 120,
            'description': 'ä¸Šåˆè¿ç»­ç«ä»·',
            'emotion_significance': 'â­â­â­â­ ä¸»åŠ›èµ„é‡‘æ´»è·ƒæ—¶æ®µ'
        },
        'lunch_break': {
            'start_time': time(11, 30, 0),
            'end_time': time(13, 0, 0),
            'duration_minutes': 90,
            'description': 'åˆé—´ä¼‘å¸‚',
            'emotion_significance': 'â­ æ— äº¤æ˜“ï¼Œæƒ…ç»ªé…é…¿æœŸ'
        },
        'afternoon_continuous': {
            'start_time': time(13, 0, 0),
            'end_time': time(14, 57, 0),
            'duration_minutes': 117,
            'description': 'ä¸‹åˆè¿ç»­ç«ä»·',
            'emotion_significance': 'â­â­â­â­ æ—¥å†…æƒ…ç»ªæ³¢åŠ¨å…³é”®æœŸ'
        },
        'closing_call_auction': {
            'start_time': time(14, 57, 0),
            'end_time': time(15, 0, 0),
            'duration_minutes': 3,
            'description': 'æ”¶ç›˜é›†åˆç«ä»·',
            'sub_phases': {
                'order_phase': {'start': time(14, 57, 0), 'end': time(14, 57, 0), 'desc': 'åªèƒ½ç”³æŠ¥ä¸èƒ½æ’¤å•'},
                'match_phase': {'time': time(15, 0, 0), 'desc': 'æ”¶ç›˜ä»·æ’®åˆ'},
            },
            'emotion_significance': 'â­â­â­â­â­ æ”¶ç›˜æƒ…ç»ªå®šè°ƒæ—¶æ®µ',
            'note': 'v2.0æ–°å¢ï¼šæ”¶ç›˜ç«ä»·å¯¹æ¬¡æ—¥å¼€ç›˜å½±å“é‡å¤§'
        }
    }

    return {
        'sessions': sessions,
        'total_trading_minutes': 240,
        'emotion_key_periods': ['å¼€ç›˜é›†åˆç«ä»·', 'æ”¶ç›˜é›†åˆç«ä»·', 'å°¾ç›˜15åˆ†é’Ÿ'],
        'version': 'v2.0',
        'compliance': 'âœ… åŸºäºå®é™…äº¤æ˜“æ—¶æ®µï¼Œæ— æŠ€æœ¯æŒ‡æ ‡'
    }

def is_trading_time(check_time: time) -> Dict:
    """
    v2.0æ–°å¢ï¼šåˆ¤æ–­æŒ‡å®šæ—¶é—´æ˜¯å¦ä¸ºäº¤æ˜“æ—¶æ®µ
    è¿”å›è¯¦ç»†çš„æ—¶æ®µä¿¡æ¯
    """
    sessions = get_trading_sessions_v2()['sessions']

    for session_name, session_info in sessions.items():
        if 'start_time' in session_info and 'end_time' in session_info:
            if session_info['start_time'] <= check_time < session_info['end_time']:
                return {
                    'is_trading': True,
                    'session': session_name,
                    'description': session_info['description'],
                    'emotion_significance': session_info['emotion_significance']
                }

    return {
        'is_trading': False,
        'session': 'non_trading',
        'description': 'éäº¤æ˜“æ—¶æ®µ'
    }

# ä½¿ç”¨ç¤ºä¾‹
print("â° Aè‚¡äº¤æ˜“æ—¶æ®µ (v2.0):")
sessions_info = get_trading_sessions_v2()
for name, info in sessions_info['sessions'].items():
    if 'start_time' in info:
        print(f"{info['description']}: {info['start_time']}-{info['end_time']} "
              f"({info['duration_minutes']}åˆ†é’Ÿ) {info['emotion_significance']}")
```

---

## ğŸ“ˆ æ¶¨è·Œåœæ¿åˆ¶åº¦ (v2.0æ³¨å†Œåˆ¶å®Œæ•´ç‰ˆ)

### 2025å¹´æœ€æ–°æ¶¨è·Œåœè§„åˆ™

```python
from enum import Enum
from dataclasses import dataclass
from typing import Optional

class BoardType(Enum):
    """Aè‚¡æ¿å—ç±»å‹æšä¸¾"""
    MAIN_SH = "ä¸»æ¿-ä¸Šäº¤æ‰€"
    MAIN_SZ = "ä¸»æ¿-æ·±äº¤æ‰€"
    STAR = "ç§‘åˆ›æ¿"
    GEM = "åˆ›ä¸šæ¿"
    BSE = "åŒ—äº¤æ‰€"
    ST = "STè‚¡ç¥¨"

@dataclass
class PriceLimitRule:
    """æ¶¨è·Œåœè§„åˆ™"""
    board_type: BoardType
    limit_up_pct: float
    limit_down_pct: float
    special_notes: str
    emotion_factor: float  # v2.0æ–°å¢ï¼šæƒ…ç»ªæ”¾å¤§ç³»æ•°

def get_price_limit_rules_v2() -> Dict[BoardType, PriceLimitRule]:
    """
    v2.0å®Œæ•´ç‰ˆï¼šè·å–Aè‚¡æ¶¨è·Œåœè§„åˆ™
    2025å¹´æ³¨å†Œåˆ¶å…¨é¢å®æ–½åçš„æœ€æ–°æ ‡å‡†
    """

    rules = {
        BoardType.MAIN_SH: PriceLimitRule(
            board_type=BoardType.MAIN_SH,
            limit_up_pct=10.0,
            limit_down_pct=-10.0,
            special_notes="é¦–æ—¥ä¸è®¾æ¶¨è·Œå¹…é™åˆ¶ï¼ˆæ³¨å†Œåˆ¶æ–°è‚¡é™¤å¤–ï¼‰",
            emotion_factor=1.0  # ä¸»æ¿æƒ…ç»ªåŸºå‡†
        ),
        BoardType.MAIN_SZ: PriceLimitRule(
            board_type=BoardType.MAIN_SZ,
            limit_up_pct=10.0,
            limit_down_pct=-10.0,
            special_notes="é¦–æ—¥ä¸è®¾æ¶¨è·Œå¹…é™åˆ¶ï¼ˆæ³¨å†Œåˆ¶æ–°è‚¡é™¤å¤–ï¼‰",
            emotion_factor=1.0
        ),
        BoardType.STAR: PriceLimitRule(
            board_type=BoardType.STAR,
            limit_up_pct=20.0,
            limit_down_pct=-20.0,
            special_notes="æ³¨å†Œåˆ¶ï¼Œå‰5ä¸ªäº¤æ˜“æ—¥æ— æ¶¨è·Œåœé™åˆ¶",
            emotion_factor=1.5  # ç§‘åˆ›æ¿æƒ…ç»ªæ”¾å¤§1.5å€
        ),
        BoardType.GEM: PriceLimitRule(
            board_type=BoardType.GEM,
            limit_up_pct=20.0,
            limit_down_pct=-20.0,
            special_notes="æ³¨å†Œåˆ¶ï¼Œå‰5ä¸ªäº¤æ˜“æ—¥æ— æ¶¨è·Œåœé™åˆ¶",
            emotion_factor=1.4  # åˆ›ä¸šæ¿æƒ…ç»ªæ”¾å¤§1.4å€
        ),
        BoardType.BSE: PriceLimitRule(
            board_type=BoardType.BSE,
            limit_up_pct=30.0,
            limit_down_pct=-30.0,
            special_notes="é¦–æ—¥æ— æ¶¨è·Œåœé™åˆ¶",
            emotion_factor=2.0  # åŒ—äº¤æ‰€æƒ…ç»ªæ”¾å¤§2.0å€ï¼ˆé«˜æ³¢åŠ¨ï¼‰
        ),
        BoardType.ST: PriceLimitRule(
            board_type=BoardType.ST,
            limit_up_pct=5.0,
            limit_down_pct=-5.0,
            special_notes="é€€å¸‚é£é™©è­¦ç¤ºè‚¡ç¥¨",
            emotion_factor=1.8  # STè‚¡æƒ…ç»ªæç«¯æ”¾å¤§
        ),
    }

    return rules

def calculate_limit_prices_v2(stock_code: str, prev_close: float,
                              is_new_stock: bool = False,
                              days_since_ipo: int = 999) -> Dict:
    """
    v2.0å¢å¼ºç‰ˆï¼šè®¡ç®—æ¶¨è·Œåœä»·æ ¼
    æ–°å¢æ–°è‚¡ç‰¹æ®Šå¤„ç†
    """

    # è¯†åˆ«æ¿å—ç±»å‹
    board = identify_board_type(stock_code)
    rules = get_price_limit_rules_v2()
    rule = rules[board]

    # v2.0æ–°å¢ï¼šæ–°è‚¡ç‰¹æ®Šå¤„ç†
    if is_new_stock and days_since_ipo <= 5:
        if board in [BoardType.STAR, BoardType.GEM, BoardType.BSE]:
            return {
                'has_limit': False,
                'limit_up': None,
                'limit_down': None,
                'reason': f'{board.value}å‰5ä¸ªäº¤æ˜“æ—¥æ— æ¶¨è·Œåœé™åˆ¶',
                'emotion_note': 'âš ï¸ æ–°è‚¡æ³¢åŠ¨æå¤§ï¼Œæƒ…ç»ªæŒ‡æ ‡éœ€è°¨æ…ä½¿ç”¨'
            }

    # è®¡ç®—æ¶¨è·Œåœä»·æ ¼ï¼ˆç²¾ç¡®åˆ°åˆ†ï¼‰
    limit_up = round(prev_close * (1 + rule.limit_up_pct / 100), 2)
    limit_down = round(prev_close * (1 + rule.limit_down_pct / 100), 2)

    return {
        'stock_code': stock_code,
        'prev_close': prev_close,
        'board_type': board.value,
        'has_limit': True,
        'limit_up': limit_up,
        'limit_down': limit_down,
        'limit_up_pct': rule.limit_up_pct,
        'limit_down_pct': rule.limit_down_pct,
        'emotion_factor': rule.emotion_factor,  # v2.0å…³é”®æŒ‡æ ‡
        'special_notes': rule.special_notes,
        'version': 'v2.0'
    }

def identify_board_type(stock_code: str) -> BoardType:
    """v2.0å¢å¼ºï¼šè¯†åˆ«è‚¡ç¥¨æ¿å—ç±»å‹"""
    code = stock_code[:6] if '.' in stock_code else stock_code

    # STè‚¡ç¥¨åˆ¤æ–­ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    if code.startswith('ST') or '*ST' in code:
        return BoardType.ST

    # ç§‘åˆ›æ¿ (688xxx)
    if code.startswith('688'):
        return BoardType.STAR

    # åˆ›ä¸šæ¿ (300xxx)
    if code.startswith('300'):
        return BoardType.GEM

    # åŒ—äº¤æ‰€ (43xxxx, 83xxxx)
    if code.startswith('43') or code.startswith('83'):
        return BoardType.BSE

    # ä¸Šäº¤æ‰€ä¸»æ¿ (60xxxx)
    if code.startswith('60'):
        return BoardType.MAIN_SH

    # æ·±äº¤æ‰€ä¸»æ¿ (000xxx, 001xxx)
    if code.startswith('000') or code.startswith('001'):
        return BoardType.MAIN_SZ

    # é»˜è®¤æ·±äº¤æ‰€ä¸»æ¿
    return BoardType.MAIN_SZ

# ä½¿ç”¨ç¤ºä¾‹
test_stocks = [
    ('600000.SH', 10.00, 'æµ¦å‘é“¶è¡Œ-ä¸»æ¿'),
    ('688001.SH', 50.00, 'ç§‘åˆ›æ¿æ–°è‚¡'),
    ('300001.SZ', 20.00, 'åˆ›ä¸šæ¿'),
    ('430001.BJ', 15.00, 'åŒ—äº¤æ‰€'),
]

print("\nğŸ“ˆ æ¶¨è·Œåœä»·æ ¼è®¡ç®— (v2.0):")
for code, price, name in test_stocks:
    result = calculate_limit_prices_v2(code, price)
    if result['has_limit']:
        print(f"{name} ({code}): "
              f"æ¶¨åœ={result['limit_up']:.2f}å…ƒ "
              f"è·Œåœ={result['limit_down']:.2f}å…ƒ "
              f"(Â±{result['limit_up_pct']:.0f}%, "
              f"æƒ…ç»ªç³»æ•°={result['emotion_factor']:.1f})")
```

---

## ğŸ”„ T+1äº¤æ˜“åˆ¶åº¦ (v2.0å®Œæ•´ç‰ˆ)

### T+1è§„åˆ™è¯¦è§£

```python
from datetime import date, timedelta
from typing import List, Dict

class T1TradingValidator:
    """
    v2.0å¢å¼ºç‰ˆï¼šT+1äº¤æ˜“éªŒè¯å™¨
    EmotionQuantä¸“ç”¨ - å¤„ç†å„ç§T+1ç‰¹æ®Šåœºæ™¯
    """

    def __init__(self):
        self.trading_calendar = self._load_trading_calendar()

    def validate_sell_order(self, stock_code: str, buy_date: date,
                           sell_date: date) -> Dict:
        """
        éªŒè¯å–å‡ºè®¢å•æ˜¯å¦ç¬¦åˆT+1è§„åˆ™

        v2.0æ–°å¢ï¼š
        - è·¨èŠ‚å‡æ—¥æ£€æŸ¥
        - åœç‰Œæ—¥æ£€æŸ¥
        - ç‰¹æ®Šæƒ…å†µæç¤º
        """

        # åŸºç¡€T+1æ£€æŸ¥
        if buy_date == sell_date:
            return {
                'is_valid': False,
                'reason': 'T+1è§„åˆ™ï¼šå½“æ—¥ä¹°å…¥ä¸èƒ½å½“æ—¥å–å‡º',
                'suggestion': f'æœ€æ—©å¯å–æ—¥æœŸ: {self._next_trading_day(buy_date)}',
                'emotion_note': 'âš ï¸ T+1é™åˆ¶ï¼Œæƒ…ç»ªç­–ç•¥éœ€è€ƒè™‘éš”æ—¥é£é™©'
            }

        # æ£€æŸ¥æ˜¯å¦è·¨éäº¤æ˜“æ—¥
        actual_trading_days = self._count_trading_days(buy_date, sell_date)

        if actual_trading_days < 1:
            return {
                'is_valid': False,
                'reason': 'å–å‡ºæ—¥æœŸä¸æ˜¯äº¤æ˜“æ—¥æˆ–æœªæ»¡è¶³T+1',
                'actual_trading_days': actual_trading_days,
                'suggestion': f'è¯·åœ¨äº¤æ˜“æ—¥å–å‡º'
            }

        return {
            'is_valid': True,
            'buy_date': buy_date.isoformat(),
            'sell_date': sell_date.isoformat(),
            'holding_days': (sell_date - buy_date).days,
            'actual_trading_days': actual_trading_days,
            'compliance': 'âœ… ç¬¦åˆT+1è§„åˆ™'
        }

    def get_earliest_sell_date(self, buy_date: date) -> date:
        """v2.0ï¼šè·å–æœ€æ—©å¯å–æ—¥æœŸï¼ˆè€ƒè™‘èŠ‚å‡æ—¥ï¼‰"""
        return self._next_trading_day(buy_date)

    def _next_trading_day(self, current_date: date) -> date:
        """è·å–ä¸‹ä¸€ä¸ªäº¤æ˜“æ—¥"""
        next_day = current_date + timedelta(days=1)
        while not self._is_trading_day(next_day):
            next_day += timedelta(days=1)
        return next_day

    def _count_trading_days(self, start_date: date, end_date: date) -> int:
        """è®¡ç®—äº¤æ˜“æ—¥æ•°é‡"""
        if start_date >= end_date:
            return 0

        count = 0
        current = start_date + timedelta(days=1)
        while current <= end_date:
            if self._is_trading_day(current):
                count += 1
            current += timedelta(days=1)
        return count

    def _is_trading_day(self, check_date: date) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºäº¤æ˜“æ—¥ï¼ˆç®€åŒ–å®ç°ï¼‰"""
        # å®é™…åº”æŸ¥è¯¢äº¤æ˜“æ—¥å†
        weekday = check_date.weekday()
        return weekday < 5  # å‘¨ä¸€åˆ°å‘¨äº”

    def _load_trading_calendar(self) -> List[date]:
        """åŠ è½½äº¤æ˜“æ—¥å†ï¼ˆç®€åŒ–å®ç°ï¼‰"""
        # å®é™…åº”ä»TuShare ProåŠ è½½
        return []

# ä½¿ç”¨ç¤ºä¾‹
validator = T1TradingValidator()

print("\nğŸ”„ T+1è§„åˆ™éªŒè¯:")
test_cases = [
    (date(2025, 2, 10), date(2025, 2, 10), 'å½“æ—¥ä¹°å–'),
    (date(2025, 2, 10), date(2025, 2, 11), 'æ¬¡æ—¥å–å‡º'),
    (date(2025, 2, 14), date(2025, 2, 17), 'è·¨å‘¨æœ«'),
]

for buy, sell, desc in test_cases:
    result = validator.validate_sell_order('600000.SH', buy, sell)
    status = "âœ…" if result['is_valid'] else "âŒ"
    print(f"{status} {desc}: {result.get('reason', result.get('compliance'))}")
```

---

## ğŸ“Š EmotionQuanté›†æˆ (v2.0å®Œæ•´ç‰ˆ)

### MSSæƒ…ç»ªç³»ç»Ÿé›†æˆ

```python
def get_market_emotion_data_v2(trade_date: str) -> Dict:
    """
    v2.0å¢å¼ºç‰ˆï¼šè·å–å¸‚åœºæƒ…ç»ªæ•°æ®
    EmotionQuant MSSç³»ç»Ÿä¸“ç”¨

    æ–°å¢åŠŸèƒ½:
    - æ¶¨è·Œåœæƒ…ç»ªæƒé‡
    - æˆäº¤é¢æ´»è·ƒåº¦
    - æ¿å—åˆ†åŒ–åº¦
    """

    import tushare as ts
    pro = ts.pro_api()

    try:
        # è·å–å¸‚åœºæ¦‚å†µ
        df_market = pro.daily(trade_date=trade_date)

        if df_market.empty:
            return {'error': 'æ— äº¤æ˜“æ•°æ®', 'is_trading_day': False}

        # åŸºç¡€ç»Ÿè®¡
        total_stocks = len(df_market)
        rise_stocks = len(df_market[df_market['pct_chg'] > 0])
        fall_stocks = len(df_market[df_market['pct_chg'] < 0])
        flat_stocks = total_stocks - rise_stocks - fall_stocks

        # v2.0: æ¶¨è·Œåœç»Ÿè®¡ï¼ˆæŒ‰æ¿å—åˆ†ç±»ï¼‰
        limit_up_main = len(df_market[
            (df_market['pct_chg'] >= 9.9) &
            (df_market['ts_code'].str.startswith('60') | df_market['ts_code'].str.startswith('000'))
        ])
        limit_up_star = len(df_market[
            (df_market['pct_chg'] >= 19.9) &
            (df_market['ts_code'].str.startswith('688'))
        ])
        limit_up_gem = len(df_market[
            (df_market['pct_chg'] >= 19.9) &
            (df_market['ts_code'].str.startswith('300'))
        ])

        # v2.0: æƒ…ç»ªæ¸©åº¦è®¡ç®—ï¼ˆå¤šç»´åº¦ï¼‰
        base_emotion = (rise_stocks / total_stocks) * 100

        limit_emotion = (
            (limit_up_main * 1.0 + limit_up_star * 1.5 + limit_up_gem * 1.4) /
            total_stocks * 100
        )

        amount_data = df_market['amount'].sum()
        avg_amount = df_market['amount'].mean()
        activity_score = (amount_data / (avg_amount * total_stocks) - 1) * 10 if avg_amount > 0 else 0

        # v2.0: ç»¼åˆæƒ…ç»ªæ¸©åº¦
        comprehensive_emotion = (
            base_emotion * 0.5 +
            limit_emotion * 0.3 +
            activity_score * 0.2
        )

        return {
            'trade_date': trade_date,
            'total_stocks': total_stocks,
            'rise_stocks': rise_stocks,
            'fall_stocks': fall_stocks,
            'flat_stocks': flat_stocks,
            'rise_ratio': rise_stocks / total_stocks,
            'limit_up_main': limit_up_main,
            'limit_up_star': limit_up_star,
            'limit_up_gem': limit_up_gem,
            'base_emotion': base_emotion,
            'limit_emotion': limit_emotion,
            'activity_score': activity_score,
            'comprehensive_emotion': comprehensive_emotion,
            'emotion_level': classify_emotion_level_v2(comprehensive_emotion),
            'version': 'v2.0',
            'compliance': 'âœ… åŸºäºå¸‚åœºæ•°æ®ï¼Œæ— æŠ€æœ¯æŒ‡æ ‡'
        }

    except Exception as e:
        return {'error': str(e), 'status': 'è·å–å¤±è´¥'}

def classify_emotion_level_v2(emotion_score: float) -> str:
    """v2.0ï¼šæƒ…ç»ªåˆ†çº§ï¼ˆ5çº§åˆ¶ï¼‰"""
    if emotion_score <= 20:
        return "å†°ç‚¹ï¼ˆæåº¦ææ…Œï¼‰"
    elif emotion_score <= 40:
        return "ä¿®å¤ï¼ˆè°¨æ…æ¢å¤ï¼‰"
    elif emotion_score <= 60:
        return "ä¹è§‚ï¼ˆæ­£å¸¸äº¤æ˜“ï¼‰"
    elif emotion_score <= 80:
        return "ç‹‚çƒ­ï¼ˆé«˜åº¦æ´»è·ƒï¼‰"
    else:
        return "å›è½ï¼ˆè¿‡çƒ­è­¦æƒ•ï¼‰"

# ä½¿ç”¨ç¤ºä¾‹
print("\nğŸŒ¡ï¸ MSSå¸‚åœºæƒ…ç»ªåˆ†æ (v2.0):")
emotion_data = get_market_emotion_data_v2('20250212')

if 'error' not in emotion_data:
    print(f"æ—¥æœŸ: {emotion_data['trade_date']}")
    print(f"ç»¼åˆæƒ…ç»ª: {emotion_data['comprehensive_emotion']:.1f}Â°C")
    print(f"æƒ…ç»ªç­‰çº§: {emotion_data['emotion_level']}")
    print(f"æ¶¨è·Œæ¯”: {emotion_data['rise_ratio']:.2%}")
    print(f"æ¶¨åœæ•°: ä¸»æ¿{emotion_data['limit_up_main']} "
          f"ç§‘åˆ›{emotion_data['limit_up_star']} åˆ›ä¸š{emotion_data['limit_up_gem']}")
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### v2.0æ›´æ–°å‚è€ƒ

- [ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€äº¤æ˜“è§„åˆ™2025ç‰ˆ](http://www.sse.com.cn/)

- [æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€äº¤æ˜“è§„åˆ™2025ç‰ˆ](http://www.szse.cn/)

- [åŒ—äº¬è¯åˆ¸äº¤æ˜“æ‰€äº¤æ˜“è§„åˆ™](http://www.bse.cn/)

- [TuShare Proäº¤æ˜“æ—¥å†æ¥å£](https://tushare.pro/document/2?doc_id=26)

### å®˜æ–¹è§„åˆ™æ–‡æ¡£

- [ä¸Šäº¤æ‰€äº¤æ˜“è§„åˆ™](http://www.sse.com.cn/lawandrules/sselawsrules/trading/)

- [æ·±äº¤æ‰€äº¤æ˜“è§„åˆ™](http://www.szse.cn/lawrules/rule/)

- [åŒ—äº¤æ‰€äº¤æ˜“è§„åˆ™](http://www.bse.cn/lawrules/)

---

## ğŸ”š ç»“è¯­

### v2.0æ ¸å¿ƒæ”¹è¿›

1. âœ… **2025å¹´è§„åˆ™åŒæ­¥**: æ³¨å†Œåˆ¶å…¨é¢å®æ–½åçš„æœ€æ–°æ ‡å‡†

2. âœ… **æ¶¨è·Œåœç»†åŒ–**: æ¿å—å·®å¼‚åŒ–å¤„ç† + æƒ…ç»ªç³»æ•°

3. âœ… **T+1å¢å¼º**: ç‰¹æ®Šåœºæ™¯è¦†ç›– + èŠ‚å‡æ—¥å¤„ç†

4. âœ… **é›†åˆç«ä»·è¯¦è§£**: ç²¾ç¡®åˆ°ç§’çº§çš„æ—¶æ®µåˆ’åˆ†

5. âœ… **EmotionQuantæ·±åº¦é›†æˆ**: MSS+IRS+PASå…¨ç³»ç»Ÿé€‚é…

### åˆè§„æ‰¿è¯º

- ğŸš« **é›¶æŠ€æœ¯æŒ‡æ ‡**: æ‰€æœ‰åˆ†æåŸºäºå¸‚åœºåŸºç¡€æ•°æ®

- ğŸ‡¨ğŸ‡³ **Aè‚¡ä¸“å±**: 100%ç¬¦åˆä¸­å›½Aè‚¡äº¤æ˜“è§„åˆ™

- ğŸ—‚ï¸ **æœ¬åœ°æ•°æ®ä¼˜å…ˆ**: è§„åˆ™æ•°æ®ä¼˜å…ˆæœ¬åœ°å­˜å‚¨ï¼Œå¤–éƒ¨æ•°æ®ä»…ç”¨äºç¦»çº¿æ›´æ–°

- ğŸ” **è·¯å¾„ç¡¬ç¼–ç ç»å¯¹ç¦æ­¢**: è·¯å¾„/å¯†é’¥/é…ç½®é€šè¿‡ç¯å¢ƒå˜é‡æˆ–é…ç½®æ³¨å…¥

- ğŸ” **æ’æ˜Ÿç»„åœ°ä½**: æƒå¨å‚è€ƒæ–‡æ¡£ â­â­â­

---

*æœ€åæ›´æ–°: 2025-02-12*
*æ–‡æ¡£ç‰ˆæœ¬: v2.0*
*EmotionQuanté¡¹ç›® - æ’æ˜Ÿç»„æ–‡æ¡£ â­â­â­*




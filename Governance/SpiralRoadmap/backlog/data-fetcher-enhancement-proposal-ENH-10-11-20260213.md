# æ•°æ®é‡‡é›†å¢å¼ºæ–¹æ¡ˆï¼šENH-10 & ENH-11

**ææ¡ˆæ—¥æœŸ**: 2026-02-13  
**ææ¡ˆäºº**: ç”¨æˆ·éœ€æ±‚  
**çŠ¶æ€**: Draftï¼ˆå¾…è¯„å®¡ï¼‰  
**ç›®æ ‡**: åœ¨ç°æœ‰è·¯çº¿å›¾åŸºç¡€ä¸Šï¼Œå¢åŠ å…¨è‡ªåŠ¨æ•°æ®é‡‡é›†èƒ½åŠ›

---

## 1. éœ€æ±‚èƒŒæ™¯

ç”¨æˆ·å¸Œæœ›ç³»ç»Ÿå…·å¤‡ï¼š
1. åˆ†æ‰¹ä¸‹è½½ï¼ˆä¸æƒ³ä¸€æ¬¡æ€§ä¸‹è½½ 13 å¹´æ•°æ®ï¼‰
2. æ–­ç‚¹ç»­ä¼ ï¼ˆä¸­é€”å¤±è´¥èƒ½ç»§ç»­ï¼‰
3. å¤šçº¿ç¨‹åŠ é€Ÿï¼ˆå¹¶è¡Œä¸‹è½½ï¼‰
4. å®šæ—¶è‡ªåŠ¨ä¸‹è½½ï¼ˆæ¯æ—¥ 16:00 è‡ªåŠ¨æ‰§è¡Œï¼‰
5. å¼€æœºè‡ªåŠ¨è¿è¡Œï¼ˆå¼€æœºå³å¯åŠ¨ï¼‰

å½“å‰è·¯çº¿å›¾ç¼ºå£ï¼š
- âŒ åˆ†æ‰¹ä¸‹è½½
- âŒ æ–­ç‚¹ç»­ä¼ 
- âŒ å¤šçº¿ç¨‹ä¸‹è½½
- âŒ å®šæ—¶è‡ªåŠ¨ä¸‹è½½
- âŒ å¼€æœºè‡ªåŠ¨è¿è¡Œ

---

## 2. å¢å¼ºæ–¹æ¡ˆæ€»è§ˆ

æ–°å¢å¤–æŒ‚åŒ…ï¼š

| ç¼–å· | åç§° | ç›®æ ‡ | å®æ–½åœˆ | é¢„ä¼°å·¥æ—¶ |
|---|---|---|---|---|
| ENH-10 | æ•°æ®é‡‡é›†å¢å¼º | åˆ†æ‰¹+æ–­ç‚¹ç»­ä¼ +å¤šçº¿ç¨‹ | S3aï¼ˆS2åã€S3å‰ï¼‰ | 2.5d |
| ENH-11 | å®šæ—¶è°ƒåº¦å™¨ | æ¯æ—¥è‡ªåŠ¨ä¸‹è½½+å¼€æœºè‡ªå¯ | S7aï¼ˆS6åï¼‰ | 1.5d |

å®æ–½ç­–ç•¥ï¼šæ¨è ENH-10 å‰ç§»åˆ° S3aï¼ŒENH-11 ä¿æŒ S6 åå®æ–½ï¼ˆS7aï¼‰

---

## 3. ENH-10: æ•°æ®é‡‡é›†å¢å¼º

### 3.1 åŠŸèƒ½å®šä¹‰

æ ¸å¿ƒèƒ½åŠ›ï¼š
1. å°†å¤§æ—¶é—´èŒƒå›´æ‹†åˆ†ä¸ºå¤šä¸ªæ‰¹æ¬¡ï¼ˆå¦‚æŒ‰å¹´åº¦ï¼‰
2. è®°å½•æ¯ä¸ªæ‰¹æ¬¡çš„ä¸‹è½½è¿›åº¦
3. æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆè·³è¿‡å·²å®Œæˆæ‰¹æ¬¡ï¼‰
4. æ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œä¸‹è½½ï¼ˆé»˜è®¤ 3 çº¿ç¨‹ï¼‰
5. æä¾›è¿›åº¦æŸ¥è¯¢å‘½ä»¤

### 3.2 å‘½ä»¤æ¥å£

```bash
# åˆ†æ‰¹ä¸‹è½½ 2013-2026 æ•°æ®ï¼ˆæ¯æ‰¹ 1 å¹´ï¼Œ3 çº¿ç¨‹ï¼‰
eq fetch-batch --start 20130101 --end 20260213 --batch-size 365 --workers 3

# æ–­ç‚¹ç»­ä¼ ï¼ˆè‡ªåŠ¨è·³è¿‡å·²å®Œæˆæ‰¹æ¬¡ï¼‰
eq fetch-batch --start 20130101 --end 20260213 --resume

# æŸ¥çœ‹ä¸‹è½½è¿›åº¦
eq fetch-status
# è¾“å‡ºç¤ºä¾‹ï¼š
# æ€»æ‰¹æ¬¡: 14
# å·²å®Œæˆ: 11 (2013-2023)
# è¿›è¡Œä¸­: 1 (2024, 65%)
# å¾…ä¸‹è½½: 2 (2025-2026)
# å¤±è´¥: 0

# é‡è¯•å¤±è´¥æ‰¹æ¬¡
eq fetch-retry
```

### 3.3 æŠ€æœ¯å®ç°è¦ç‚¹

#### è¿›åº¦æ–‡ä»¶æ ¼å¼

```json
{
  "version": "1.0",
  "total_batches": 14,
  "batches": [
    {
      "batch_id": "2013",
      "start_date": "20130101",
      "end_date": "20131231",
      "status": "completed",
      "completed_at": "2026-02-13 10:23:45"
    },
    {
      "batch_id": "2024",
      "start_date": "20240101",
      "end_date": "20241231",
      "status": "running",
      "progress": 0.65
    },
    {
      "batch_id": "2025",
      "start_date": "20250101",
      "end_date": "20251231",
      "status": "pending"
    }
  ]
}
```

å­˜å‚¨ä½ç½®ï¼š`${CACHE_PATH}/fetch_progress.json`

#### å¤šçº¿ç¨‹ç­–ç•¥

- é»˜è®¤ 3 çº¿ç¨‹ï¼ˆé¿å… TuShare é™æµï¼‰
- æ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªæ‰¹æ¬¡
- çº¿ç¨‹é—´äº’ä¸å¹²æ‰°
- å¤±è´¥æ‰¹æ¬¡è‡ªåŠ¨é‡è¯• 3 æ¬¡

#### æ–­ç‚¹ç»­ä¼ é€»è¾‘

1. å¯åŠ¨æ—¶è¯»å– `fetch_progress.json`
2. è¿‡æ»¤å‡º `status != "completed"` çš„æ‰¹æ¬¡
3. ä¼˜å…ˆå¤„ç† `status == "failed"` çš„æ‰¹æ¬¡
4. æ¯å®Œæˆä¸€ä¸ªæ‰¹æ¬¡ï¼Œç«‹å³æ›´æ–°è¿›åº¦æ–‡ä»¶

### 3.4 æ–‡ä»¶ç»“æ„

```
src/data/
â”œâ”€â”€ fetcher.py                    # åŸºç¡€é‡‡é›†å™¨ï¼ˆS0ï¼‰
â”œâ”€â”€ fetcher_enhanced.py           # å¢å¼ºé‡‡é›†å™¨ï¼ˆENH-10ï¼‰
â””â”€â”€ batch_progress.py             # è¿›åº¦ç®¡ç†

tests/
â””â”€â”€ test_fetcher_enhanced.py      # å¢å¼ºé‡‡é›†å™¨æµ‹è¯•

scripts/
â””â”€â”€ fetch_batch.py                # CLI å…¥å£
```

### 3.5 ä»»åŠ¡åˆ†è§£

| ä»»åŠ¡ | äº§å‡º | å·¥æ—¶ |
|---|---|---|
| ENH10-T1: æ‰¹æ¬¡ç”Ÿæˆä¸è¿›åº¦ç®¡ç† | `batch_progress.py` | 0.5d |
| ENH10-T2: å¢å¼ºé‡‡é›†å™¨å®ç° | `fetcher_enhanced.py` | 1.0d |
| ENH10-T3: CLI å‘½ä»¤æ¥å…¥ | `eq fetch-batch/status/retry` | 0.5d |
| ENH10-T4: æµ‹è¯•ä¸æ–‡æ¡£ | æµ‹è¯•ç”¨ä¾‹ + ä½¿ç”¨æ–‡æ¡£ | 0.5d |

### 3.6 éªŒæ”¶é—¨ç¦

- [ ] `eq fetch-batch --start 20130101 --end 20131231` å¯æ‰§è¡Œ
- [ ] ä¸­é€” Ctrl+C åï¼Œ`eq fetch-batch --resume` èƒ½ç»§ç»­
- [ ] `eq fetch-status` èƒ½æ˜¾ç¤ºæ­£ç¡®è¿›åº¦
- [ ] å¤šçº¿ç¨‹ä¸‹è½½é€Ÿåº¦ > å•çº¿ç¨‹ 2 å€
- [ ] è‡³å°‘ 1 ç»„è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡

### 3.7 S3a é—­ç¯åˆåŒï¼ˆæ‰§è¡Œåœˆæ¨¡æ¿ï¼‰

- åœˆä½ï¼š`S3a`ï¼ˆç´§æ¥ S2b PASS åï¼Œè¿›å…¥ S3 å‰ï¼‰
- ä¸»ç›®æ ‡ï¼šäº¤ä»˜ ENH-10 æœ€å°ç”Ÿäº§å¯ç”¨èƒ½åŠ›ï¼Œä¸æ‰©å±•è°ƒåº¦å™¨èƒ½åŠ›
- runï¼š
  - `eq fetch-batch --start 20130101 --end {trade_date} --batch-size 365 --workers 3`
  - `eq fetch-status`
- testï¼š
  - `pytest tests/unit/data/test_fetcher_enhanced.py -q`
- artifactï¼š
  - `artifacts/spiral-s3a/{trade_date}/fetch_progress.json`
  - `artifacts/spiral-s3a/{trade_date}/fetch_retry_report.md`
  - `artifacts/spiral-s3a/{trade_date}/throughput_benchmark.md`
- reviewï¼š
  - `Governance/specs/spiral-s3a/review.md`
- syncï¼š
  - `Governance/specs/spiral-s3a/final.md`
  - `Governance/record/development-status.md`
  - `Governance/record/debts.md`
  - `Governance/record/reusable-assets.md`
  - `Governance/Capability/SPIRAL-CP-OVERVIEW.md`

---

## 4. ENH-11: å®šæ—¶è°ƒåº¦å™¨

### 4.1 åŠŸèƒ½å®šä¹‰

æ ¸å¿ƒèƒ½åŠ›ï¼š
1. æ¯æ—¥ 16:00 è‡ªåŠ¨ä¸‹è½½æœ€æ–°æ•°æ®
2. è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦äº¤æ˜“æ—¥ï¼ˆéäº¤æ˜“æ—¥è·³è¿‡ï¼‰
3. æ£€æŸ¥æ˜¯å¦å·²ä¸‹è½½ï¼ˆé¿å…é‡å¤ï¼‰
4. å¤±è´¥æ—¶å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
5. å¼€æœºè‡ªåŠ¨å¯åŠ¨è°ƒåº¦å™¨

### 4.2 å‘½ä»¤æ¥å£

```bash
# å¯åŠ¨è°ƒåº¦å™¨ï¼ˆåå°è¿è¡Œï¼‰
eq scheduler start

# æŸ¥çœ‹è°ƒåº¦å™¨çŠ¶æ€
eq scheduler status
# è¾“å‡ºç¤ºä¾‹ï¼š
# çŠ¶æ€: è¿è¡Œä¸­
# PID: 12345
# ä¸‹æ¬¡æ‰§è¡Œ: 2026-02-14 16:00
# æœ€è¿‘æ‰§è¡Œ: 2026-02-13 16:00 (æˆåŠŸ)
# æœ€è¿‘ 5 æ¬¡æ‰§è¡Œè®°å½•:
#   2026-02-13 16:00 - æˆåŠŸ (è€—æ—¶ 2m 15s)
#   2026-02-12 16:00 - æˆåŠŸ (è€—æ—¶ 1m 58s)
#   2026-02-11 16:00 - è·³è¿‡ (éäº¤æ˜“æ—¥)

# åœæ­¢è°ƒåº¦å™¨
eq scheduler stop

# æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ï¼ˆæµ‹è¯•ç”¨ï¼‰
eq scheduler run-once
```

### 4.3 æŠ€æœ¯å®ç°æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1ï¼šWindows ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆæ¨èï¼‰

ä¼˜ç‚¹ï¼š
- ç³»ç»ŸåŸç”Ÿæ”¯æŒ
- å¼€æœºè‡ªå¯ç®€å•
- ä¸å ç”¨ Python è¿›ç¨‹

å®ç°ï¼š
```powershell
# åˆ›å»ºä»»åŠ¡ï¼ˆå®‰è£…æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
eq scheduler install

# å†…éƒ¨è°ƒç”¨ Windows API
$action = New-ScheduledTaskAction -Execute "eq" -Argument "run --date today --source tushare"
$trigger = New-ScheduledTaskTrigger -Daily -At 16:00
$settings = New-ScheduledTaskSettingsSet -StartWhenAvailable
Register-ScheduledTask -TaskName "EmotionQuant-DailyFetch" -Action $action -Trigger $trigger -Settings $settings
```

#### æ–¹æ¡ˆ 2ï¼šPython å†…ç½®è°ƒåº¦å™¨ï¼ˆå¤‡é€‰ï¼‰

ä¼˜ç‚¹ï¼š
- è·¨å¹³å°
- çµæ´»æ§åˆ¶

ç¼ºç‚¹ï¼š
- éœ€è¦å¸¸é©»è¿›ç¨‹
- å¼€æœºè‡ªå¯éœ€è¦é¢å¤–é…ç½®

å®ç°ï¼š
```python
# src/scheduler/daily_scheduler.py
import schedule
import time

class DailyScheduler:
    def start(self):
        schedule.every().day.at("16:00").do(self._daily_fetch)
        
        while True:
            schedule.run_pending()
            time.sleep(60)
    
    def _daily_fetch(self):
        # 1. æ£€æŸ¥äº¤æ˜“æ—¥
        if not self._is_trading_day():
            return
        
        # 2. æ£€æŸ¥å·²ä¸‹è½½
        if self._is_already_fetched(today()):
            return
        
        # 3. æ‰§è¡Œä¸‹è½½
        self.fetcher.fetch(date=today())
```

### 4.4 å¼€æœºè‡ªå¯é…ç½®

#### Windows

```powershell
# æ–¹æ¡ˆ 1ï¼šä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆæ¨èï¼‰
# åœ¨ä»»åŠ¡å±æ€§ä¸­å‹¾é€‰"å¼€æœºæ—¶å¯åŠ¨"

# æ–¹æ¡ˆ 2ï¼šå¯åŠ¨æ–‡ä»¶å¤¹
# åˆ›å»ºå¿«æ·æ–¹å¼åˆ°å¯åŠ¨æ–‡ä»¶å¤¹
$startup = "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup"
Copy-Item "eq-scheduler.lnk" $startup
```

### 4.5 ä»»åŠ¡åˆ†è§£

| ä»»åŠ¡ | äº§å‡º | å·¥æ—¶ |
|---|---|---|
| ENH11-T1: è°ƒåº¦å™¨æ ¸å¿ƒå®ç° | `daily_scheduler.py` | 0.5d |
| ENH11-T2: Windows ä»»åŠ¡è®¡åˆ’é›†æˆ | `eq scheduler install/uninstall` | 0.5d |
| ENH11-T3: äº¤æ˜“æ—¥åˆ¤æ–­ä¸å»é‡ | äº¤æ˜“æ—¥å†æŸ¥è¯¢ + å·²ä¸‹è½½æ£€æŸ¥ | 0.3d |
| ENH11-T4: æµ‹è¯•ä¸æ–‡æ¡£ | æµ‹è¯•ç”¨ä¾‹ + ä½¿ç”¨æ–‡æ¡£ | 0.2d |

### 4.6 éªŒæ”¶é—¨ç¦

- [ ] `eq scheduler install` èƒ½åˆ›å»º Windows ä»»åŠ¡
- [ ] ä»»åŠ¡åœ¨ 16:00 è‡ªåŠ¨è§¦å‘
- [ ] éäº¤æ˜“æ—¥è‡ªåŠ¨è·³è¿‡
- [ ] å·²ä¸‹è½½æ•°æ®ä¸é‡å¤æ‹‰å–
- [ ] `eq scheduler status` èƒ½æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€
- [ ] å¼€æœºåè°ƒåº¦å™¨è‡ªåŠ¨è¿è¡Œ

---

## 5. è·¯çº¿å›¾é›†æˆæ–¹æ¡ˆ

### 5.1 åŠ åœ¨å“ªé‡Œ

#### æ–¹æ¡ˆ Aï¼šS3a + S7a åˆ†å±‚å®æ–½ï¼ˆæ¨èï¼‰

```
S0 â†’ S1 â†’ S2 â†’ S3a(ENH-10) â†’ S3 â†’ S4 â†’ S5 â†’ S6 â†’ S7a(ENH-11)
              (2.5d)                                     (1.5d)
```

**ä¼˜ç‚¹**ï¼š
- åœ¨å›æµ‹åœˆï¼ˆS3ï¼‰å‰è¡¥é½å†å²æ•°æ®æ‹‰å–èƒ½åŠ›
- ä¸æŠŠ ENH-11 æå‰å¼•å…¥ï¼Œé¿å…è¿è¥èƒ½åŠ›æ‰“æ–­ä¸»çº¿
- ä¸â€œå…ˆæ•°æ®ã€åè°ƒåº¦â€çš„ä¾èµ–é¡ºåºä¸€è‡´

**ç¼ºç‚¹**ï¼š
- éœ€è¦æ–°å¢ä¸€ä¸ªå¾®åœˆï¼ˆS3aï¼‰åšæ˜¾å¼æ²»ç†è®°å½•

#### æ–¹æ¡ˆ Bï¼šS6 åæ‰“åŒ…å®æ–½ï¼ˆä¿å®ˆï¼‰

```
S0 â†’ S1 â†’ S2 â†’ S3 â†’ S4 â†’ S5 â†’ S6 â†’ ENH-10 â†’ ENH-11
                                    (2.5d)   (1.5d)
```

**ä¼˜ç‚¹**ï¼š
- ç»å¯¹ä¸æ‰“æ–­ä¸»çº¿åœˆåº
- æ’æœŸç®€å•

**ç¼ºç‚¹**ï¼š
- S3 å‰ç¼ºå°‘è‡ªåŠ¨åˆ†æ‰¹/æ–­ç‚¹èƒ½åŠ›ï¼Œå›æµ‹å‡†å¤‡æ•ˆç‡è¾ƒä½
- æŠŠå…³é”®æ•°æ®èƒ½åŠ›æ”¾åˆ°è¿‡æ™šé˜¶æ®µ

#### æ–¹æ¡ˆ Cï¼šS0 æ‰©å±•å®æ–½ï¼ˆæ¿€è¿›ï¼‰

```
S0 (4.5d â†’ 7.0d, å« ENH-10) â†’ S1 â†’ S2 â†’ S3 â†’ S4 â†’ S5 â†’ S6 â†’ S7a(ENH-11)
```

**ä¼˜ç‚¹**ï¼š
- æœ€æ—©æ‹¿åˆ° ENH-10 èƒ½åŠ›

**ç¼ºç‚¹**ï¼š
- S0 å·¥æœŸè†¨èƒ€ï¼Œè¿åâ€œå…ˆæœ€å°é—­ç¯å†å¢å¼ºâ€çš„èŠ‚å¥
- å¢å¤§ S0 å¤±è´¥é¢

### 5.2 æ€ä¹ˆåŠ 

#### 5.2.1 æ–‡æ¡£ä¿®æ”¹æ¸…å•

**éœ€è¦ä¿®æ”¹çš„æ–‡æ¡£**ï¼š

1. **`docs/design/enhancements/eq-improvement-plan-core-frozen.md`**
   - åœ¨ Â§4 å¤–æŒ‚å¢å¼ºåŒ…è¡¨æ ¼ä¸­æ–°å¢ ENH-10 å’Œ ENH-11 ä¸¤è¡Œ
   - ä½ç½®ï¼šENH-09 ä¹‹å

2. **`Governance/SpiralRoadmap/VORTEX-EVOLUTION-ROADMAP.md`**
   - åœ¨ Â§3.1 Spiral è¿›åº¦çœ‹æ¿ä¸­æ–°å¢ ENH-10 å’Œ ENH-11 ä¸¤è¡Œ
   - åœ¨ Â§3.3 ä¸‰åˆ†ç±»å·¥æ—¶åˆ†å¸ƒä¸­æ›´æ–°"ç³»ç»Ÿå¤–æŒ‚"æ€»è®¡
   - åœ¨ Â§12 é£é™©çŸ©é˜µä¸­æ–°å¢ç›¸å…³é£é™©

3. **`Governance/SpiralRoadmap/DEPENDENCY-MAP.md`**
   - åœ¨ Â§5 ENH å¤–æŒ‚å¢å¼ºæ’å¸ƒæ€»è§ˆä¸­æ–°å¢ ENH-10 å’Œ ENH-11
   - åœ¨ Â§5.1 ENH ç”Ÿå‘½å‘¨æœŸå›¾ä¸­æ–°å¢ä¸¤è¡Œ
   - åœ¨ Â§5.2 å¤–æŒ‚æ€»å·¥æ—¶ä¸­æ›´æ–°æ€»è®¡

4. **`Governance/Capability/SPIRAL-CP-OVERVIEW.md`**
   - åœ¨å˜æ›´è®°å½•ä¸­æ–°å¢ä¸€æ¡ï¼ˆè®°å½• ENH-10/11 çº³å…¥ï¼‰

#### 5.2.2 å…·ä½“ä¿®æ”¹å†…å®¹

**ä¿®æ”¹ 1ï¼š`eq-improvement-plan-core-frozen.md` Â§4 è¡¨æ ¼**

åœ¨ ENH-09 ä¹‹åæ–°å¢ï¼š

```markdown
| ENH-10 | æ•°æ®é‡‡é›†å¢å¼º | åˆ†æ‰¹ä¸‹è½½ + æ–­ç‚¹ç»­ä¼  + å¤šçº¿ç¨‹ | åªåšç¼–æ’ï¼Œä¸æ”¹é‡‡é›†è¯­ä¹‰ |
| ENH-11 | å®šæ—¶è°ƒåº¦å™¨ | æ¯æ—¥è‡ªåŠ¨ä¸‹è½½ + å¼€æœºè‡ªå¯ | åªåšè°ƒåº¦ï¼Œä¸æ”¹æ•°æ®é€»è¾‘ |
```

**ä¿®æ”¹ 2ï¼š`VORTEX-EVOLUTION-ROADMAP.md` Â§3.1 è¡¨æ ¼**

åœ¨ S2 ä¸ S3 ä¹‹é—´æ–°å¢ S3aï¼Œåœ¨ S6 åæ–°å¢ S7aï¼š

```markdown
| S3a | ğŸ”„ é‡‡é›†å¢å¼º | åˆ†æ‰¹+æ–­ç‚¹ç»­ä¼ +å¤šçº¿ç¨‹ | - | 2.5d | ğŸ“‹ æœªå¼€å§‹ |
| S7a | â° è‡ªåŠ¨è°ƒåº¦ | æ¯æ—¥è‡ªåŠ¨ä¸‹è½½+å¼€æœºè‡ªå¯ | - | 1.5d | ğŸ“‹ æœªå¼€å§‹ |
| **åˆè®¡** | | | | **34.1d** | |
```

**ä¿®æ”¹ 3ï¼š`DEPENDENCY-MAP.md` Â§5 è¡¨æ ¼**

æ–°å¢ä¸¤è¡Œï¼š

```markdown
| ENH-10 | æ•°æ®é‡‡é›†å¢å¼º | S3aï¼ˆS2åã€S3å‰ï¼‰ | â€” | é«˜ï¼šå†å²æ•°æ®æ‹‰å–æ•ˆç‡ |
| ENH-11 | å®šæ—¶è°ƒåº¦å™¨ | S7aï¼ˆS6åï¼‰ | â€” | ä¸­ï¼šæ—¥å¸¸è¿è¥ä¾¿åˆ©æ€§ |
```

### 5.3 åŠ ä»€ä¹ˆ

#### 5.3.1 æ–°å¢æ–‡ä»¶æ¸…å•

```
src/data/
â”œâ”€â”€ fetcher_enhanced.py           # ENH-10 æ ¸å¿ƒå®ç°
â””â”€â”€ batch_progress.py             # ENH-10 è¿›åº¦ç®¡ç†

src/scheduler/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ daily_scheduler.py            # ENH-11 æ ¸å¿ƒå®ç°
â””â”€â”€ windows_task.py               # ENH-11 Windows é›†æˆ

tests/
â”œâ”€â”€ test_fetcher_enhanced.py      # ENH-10 æµ‹è¯•
â””â”€â”€ test_daily_scheduler.py       # ENH-11 æµ‹è¯•

scripts/
â”œâ”€â”€ fetch_batch.py                # ENH-10 CLI å…¥å£
â””â”€â”€ scheduler_cli.py              # ENH-11 CLI å…¥å£

docs/
â””â”€â”€ user-guide/
    â”œâ”€â”€ data-fetcher-advanced.md  # ENH-10 ä½¿ç”¨æ–‡æ¡£
    â””â”€â”€ scheduler-setup.md        # ENH-11 ä½¿ç”¨æ–‡æ¡£
```

#### 5.3.2 æ–°å¢å‘½ä»¤æ¸…å•

```bash
# ENH-10 å‘½ä»¤
eq fetch-batch --start <date> --end <date> [--batch-size <days>] [--workers <n>] [--resume]
eq fetch-status
eq fetch-retry

# ENH-11 å‘½ä»¤
eq scheduler install
eq scheduler uninstall
eq scheduler start
eq scheduler stop
eq scheduler status
eq scheduler run-once
```

---

## 6. å®æ–½å»ºè®®

### 6.1 æ¨èæ–¹æ¡ˆï¼šS3a + S7a åˆ†å±‚å®æ–½

**ç†ç”±**ï¼š
1. ENH-10 å¯¹ S3 æ•°æ®å‡†å¤‡ç›´æ¥å¢ç›Šï¼Œåº”å‰ç§»
2. ENH-11 å±äºè¿è¥è‡ªåŠ¨åŒ–ï¼Œåº”åç½®
3. ä¿æŒä¸»çº¿â€œä¿¡å·ä¸éªŒè¯é—­ç¯ä¼˜å…ˆâ€çš„èŠ‚å¥
4. é™ä½å•åœˆå¤æ‚åº¦ï¼Œç¬¦åˆ 6A çš„å•ç›®æ ‡æ”¶å£åŸåˆ™

**æ—¶é—´çº¿**ï¼š
```
Day 0-17.4:  S0-S2 å®Œæˆ
Day 18-20.9: S3a å®æ–½ ENH-10
Day 21-30.1: S3-S6 å®Œæˆ
Day 31-32.6: S7a å®æ–½ ENH-11
```

**S3a å‰å…œåº•æ–¹æ¡ˆï¼ˆè‹¥ ENH-10 å»¶æœŸï¼‰**ï¼š

```bash
# æŒ‰å¹´åº¦æ‰‹åŠ¨æ‹‰å–ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
for year in {2013..2026}; do
  eq run --start ${year}0101 --end ${year}1231 --source tushare
  echo "å®Œæˆ $year å¹´æ•°æ®"
  sleep 60  # é¿å…é™æµ
done
```

### 6.2 å¤‡é€‰æ–¹æ¡ˆï¼šS6 åæ‰“åŒ…å®æ–½ï¼ˆä¿å®ˆï¼‰

**ç†ç”±**ï¼š
- è‹¥è¿‘æœŸç›®æ ‡åªåšä¸»çº¿é—­ç¯ï¼Œå¯å°†ä¸¤é¡¹å¤–æŒ‚ç»Ÿä¸€åç½®

**æ—¶é—´çº¿**ï¼š
```
Day 0-30.1:  S0-S6 å®Œæˆ
Day 31-33.6: ENH-10 å®æ–½
Day 34-35.1: ENH-11 å®æ–½
```

### 6.3 æ¿€è¿›æ–¹æ¡ˆï¼šS0 æ‰©å±• ENH-10ï¼ˆä¸æ¨èï¼‰

**ç†ç”±**ï¼š
- ä»…åœ¨ä½ è¦æ±‚â€œæœ€æ—©æ‹¿åˆ° ENH-10 ä¸”èƒ½æ¥å— S0 å»¶é•¿â€æ—¶è€ƒè™‘

**æ—¶é—´çº¿**ï¼š
```
Day 0-7.0:   S0(å« ENH-10) å®Œæˆ
Day 7-30.1:  S1-S6 å®Œæˆ
Day 31-32.6: S7a(ENH-11) å®æ–½
```

---

## 7. é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|---|---|---|---|
| TuShare é™æµå¯¼è‡´å¤šçº¿ç¨‹å¤±æ•ˆ | ä¸­ | ä¸­ | é™åˆ¶æœ€å¤§çº¿ç¨‹æ•°ä¸º 3ï¼Œå¢åŠ é‡è¯•æœºåˆ¶ |
| Windows ä»»åŠ¡è®¡åˆ’æƒé™é—®é¢˜ | ä½ | ä¸­ | æä¾›ç®¡ç†å‘˜æƒé™å®‰è£…æŒ‡å— |
| æ–­ç‚¹ç»­ä¼ æ–‡ä»¶æŸå | ä½ | ä½ | æ¯æ¬¡å†™å…¥å‰å¤‡ä»½è¿›åº¦æ–‡ä»¶ |
| å®šæ—¶ä»»åŠ¡æœªè§¦å‘ | ä¸­ | ä½ | æä¾›æ‰‹åŠ¨è§¦å‘å‘½ä»¤ `eq scheduler run-once` |
| å¼€æœºè‡ªå¯å¤±è´¥ | ä¸­ | ä½ | æä¾›æ‰‹åŠ¨å¯åŠ¨æŒ‡å— |

---

## 8. éªŒæ”¶æ ‡å‡†

### 8.1 ENH-10 éªŒæ”¶

- [ ] èƒ½åˆ†æ‰¹ä¸‹è½½ 2013-2026 æ•°æ®ï¼ˆæ¯æ‰¹ 1 å¹´ï¼‰
- [ ] ä¸­é€” Ctrl+C åèƒ½æ–­ç‚¹ç»­ä¼ 
- [ ] å¤šçº¿ç¨‹ä¸‹è½½é€Ÿåº¦ > å•çº¿ç¨‹ 2 å€
- [ ] `eq fetch-status` èƒ½æ˜¾ç¤ºæ­£ç¡®è¿›åº¦
- [ ] å¤±è´¥æ‰¹æ¬¡èƒ½è‡ªåŠ¨é‡è¯• 3 æ¬¡
- [ ] è‡³å°‘ 1 ç»„è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡

### 8.2 ENH-11 éªŒæ”¶

- [ ] `eq scheduler install` èƒ½åˆ›å»º Windows ä»»åŠ¡
- [ ] ä»»åŠ¡åœ¨ 16:00 è‡ªåŠ¨è§¦å‘
- [ ] éäº¤æ˜“æ—¥è‡ªåŠ¨è·³è¿‡
- [ ] å·²ä¸‹è½½æ•°æ®ä¸é‡å¤æ‹‰å–
- [ ] å¼€æœºåè°ƒåº¦å™¨è‡ªåŠ¨è¿è¡Œ
- [ ] `eq scheduler status` èƒ½æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€

---

## 9. æ€»ç»“

### 9.1 æ ¸å¿ƒç»“è®º

**å¯ä»¥åšåˆ°**ï¼Œä½†éœ€è¦æ–°å¢ ENH-10 å’Œ ENH-11 ä¸¤ä¸ªå¤–æŒ‚åŒ…ã€‚

### 9.2 æ¨èæ‰§è¡Œè·¯å¾„

```
1. å®Œæˆ S0 åŸºç¡€ç‰ˆï¼ˆ4.5dï¼‰
   â†“
2. å®Œæˆ S1-S2 ä¸»çº¿ï¼ˆåˆ°å¯æ¨èé—­ç¯ï¼‰
   â†“
3. æ‰§è¡Œ S3aï¼šå®æ–½ ENH-10ï¼ˆ2.5dï¼‰
   â†“
4. å®Œæˆ S3-S6 ä¸»çº¿
   â†“
5. æ‰§è¡Œ S7aï¼šå®æ–½ ENH-11ï¼ˆ1.5dï¼‰
   â†“
6. å…¨è‡ªåŠ¨æ•°æ®é‡‡é›†ç³»ç»Ÿå®Œæˆï¼ˆæ€»è®¡çº¦ 32.6dï¼‰
```

### 9.3 å…³é”®å†³ç­–ç‚¹

**å†³ç­– 1ï¼šä½•æ—¶å®æ–½ ENH-10/11ï¼Ÿ**
- æ¨èï¼šENH-10 åœ¨ S3aï¼ŒENH-11 åœ¨ S7a
- ä¿å®ˆï¼šä¸¤é¡¹éƒ½ S6 å
- æ¿€è¿›ï¼šENH-10 å¹¶å…¥ S0

**å†³ç­– 2ï¼šæ˜¯å¦å¿…é¡»å®æ–½ï¼Ÿ**
- ENH-10ï¼šå¯¹ S3 æ•°æ®å‡†å¤‡å¼ºçƒˆå»ºè®®å®æ–½
- ENH-11ï¼šéå¿…é¡»ï¼Œä½†èƒ½æ˜¾è‘—æå‡æ—¥å¸¸è¿è¥ä½“éªŒ

**å†³ç­– 3ï¼šå®æ–½ä¼˜å…ˆçº§ï¼Ÿ**
- é«˜ä¼˜å…ˆçº§ï¼šS0-S2 ä¸»çº¿ + ENH-10ï¼ˆS3aï¼‰
- ä¸­ä¼˜å…ˆçº§ï¼šS3-S6 ä¸»çº¿
- ä½ä¼˜å…ˆçº§ï¼šENH-11ï¼ˆS7aï¼‰

### 9.4 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¯„å®¡æœ¬ææ¡ˆ**ï¼šç¡®è®¤æ˜¯å¦é‡‡çº³ ENH-10/11
2. **ç¡®è®¤æ’æœŸ**ï¼šENH-10@S3aï¼ŒENH-11@S7a
3. **æ›´æ–°è·¯çº¿å›¾æ–‡æ¡£**ï¼šæŒ‰ç…§ Â§5.2 ä¿®æ”¹æ¸…å•æ‰§è¡Œ
4. **åˆ›å»ºä»»åŠ¡å¡ç‰‡**ï¼šå…ˆåˆ›å»º S3aï¼ˆENH-10ï¼‰ä»»åŠ¡åˆ†è§£

---

**ææ¡ˆäºº**: ç”¨æˆ·éœ€æ±‚  
**è¯„å®¡äºº**: å¾…å®š  
**å†³ç­–äºº**: å¾…å®š  
**çŠ¶æ€**: Draftï¼ˆå¾…è¯„å®¡ï¼‰

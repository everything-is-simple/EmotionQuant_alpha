# Task 级别任务规范模板

**版本**: v2.0.0
**创建日期**: 2026-02-02
**最后更新**: 2026-02-02
**适用范围**: 所有 Phase 的 Task 级别任务分解

---

## 模板说明

本模板定义 Task 级别任务的标准格式。每个 Task 必须包含：
- 输入依赖
- 输出交付
- 成功标准
- 错误处理
- 验收检查

---

## Task 任务模板

### Task N: {任务名称}

**目标**: 一句话描述本Task核心目标

#### 输入依赖

| 依赖项 | 来源 | 就绪条件 | 缺失处理 |
|--------|------|----------|----------|
| 依赖1 | Phase/模块 | 就绪判断条件 | 阻断/降级/跳过 |

#### 输出交付

| 交付物 | 类型 | 验收标准 | 存储位置 |
|--------|------|----------|----------|
| 交付物1 | 代码/文档/数据 | 量化验收条件 | 文件/表路径 |

#### 成功标准

| 标准项 | 量化指标 | 验证方法 |
|--------|----------|----------|
| 标准1 | 具体数值/比例 | 测试/检查命令 |

#### 错误处理

| 错误场景 | 处理策略 | 升级条件 |
|----------|----------|----------|
| 场景1 | 重试/跳过/降级 | 何时需人工介入 |

#### 验收检查

- [ ] 检查项1
- [ ] 检查项2
- [ ] 检查项3

---

## 示例：Phase 01 Task 2

### Task 2: L1 数据采集

**目标**: 实现8类TuShare数据的完整采集入库

#### 输入依赖

| 依赖项 | 来源 | 就绪条件 | 缺失处理 |
|--------|------|----------|----------|
| TuShare Token | 环境变量 | `TUSHARE_TOKEN` 非空 | 阻断，报错退出 |
| 数据目录 | Task 1 | `DATA_PATH` 目录存在 | 阻断，报错退出 |
| 交易日历 | TuShare | API 可调用 | 重试3次后阻断 |

#### 输出交付

| 交付物 | 类型 | 验收标准 | 存储位置 |
|--------|------|----------|----------|
| daily.parquet | 数据 | 记录数≥4500/日 | `{DATA_PATH}/parquet/daily/` |
| daily_basic.parquet | 数据 | 与daily记录数一致 | `{DATA_PATH}/parquet/daily_basic/` |
| limit_list.parquet | 数据 | limit字段∈{U,D,Z} | `{DATA_PATH}/parquet/limit_list/` |
| TuShareFetcher | 代码 | 测试覆盖≥80% | `src/data/fetcher.py` |

#### 成功标准

| 标准项 | 量化指标 | 验证方法 |
|--------|----------|----------|
| 数据完整率 | ≥99% | `COUNT(*) / 预期记录数` |
| 字段空值率 | ≤1% | `COUNT(NULL) / COUNT(*)` |
| API调用成功率 | ≥95% | 错误日志统计 |
| 采集延迟 | ≤30分钟 | `入库时间 - 收盘时间` |

#### 错误处理

| 错误场景 | 处理策略 | 升级条件 |
|----------|----------|----------|
| API限流(429) | 指数退避重试，最多5次 | 5次失败后告警 |
| 网络超时 | 重试3次，间隔递增 | 3次失败后使用缓存 |
| 数据记录不足 | 记录警告，继续处理 | <90%时告警 |

#### 验收检查

- [ ] 8类数据全部采集成功
- [ ] 数据完整率≥99%
- [ ] 无硬编码路径
- [ ] 测试覆盖率≥80%
- [ ] 错误处理逻辑完整

---

## 变更记录

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v2.0.0 | 2026-02-02 | **术语统一**: Phase→Task→Step，对齐三层结构 |
| v1.0.0 | 2026-02-02 | 初始版本 |

# EmotionQuant 系统铁律

**版本**: v3.3.0（重构版）
**最后更新**: 2026-02-05
**文档类型**: 核心约束 / 治理组权威
**状态**: 与重构设计文档对齐

---

## 文档定位

> **本文档定义系统不可违背的核心铁律（系统铁律）**
>
> - 与 `CORE-PRINCIPLES.md` 配合执行
> - 是所有Phase的合规检查基准
> - 违反即阻断，零容忍

---

## 系统铁律概览

| 铁律 | 核心要求 | 检查方式 | 违反后果 |
|------|----------|----------|----------|
| **零技术指标** | 禁用传统TA指标 | 代码扫描 + 人工评审 | 零容忍，立即回滚 |
| **情绪优先** | 所有算法基于情绪因子 | 设计评审 | 零容忍 |
| **本地数据优先** | 本地数据库/存储/读取为主 | 配置检查 + 代码审查 | 零容忍 |
| **路径硬编码绝对禁止** | 路径/密钥/配置必须注入 | 路径扫描 + 代码审查 | 零容忍 |
| **A 股专属** | 严格遵守 A 股规则 | 设计评审 + 数据校验 | 零容忍 |

---

## 铁律一：零技术指标

### 核心约束

**绝对禁止**使用任何传统技术分析指标作为信号或特征来源。

### 禁用清单

| 类别 | 禁止指标 |
|------|----------|
| 趋势类 | MA, EMA, SMA, WMA, BOLL, SAR |
| 动量类 | RSI, KDJ, CCI, WR, MACD |
| 成交量类 | OBV, VRSI, VMACD |
| 波动类 | ATR, Keltner Channel |
| 综合类 | DMI, ADX, Aroon |

### 允许使用

| 类别 | 允许数据 |
|------|----------|
| 原始数据 | OHLCV（开高低收量） |
| 统计数据 | 涨跌家数、涨跌停统计 |
| 盘口数据 | 委买委卖、逐笔成交 |
| 基本面 | 公告、财报 |

### 检查机制

```python
# pre-commit hook 检测关键词
FORBIDDEN_KEYWORDS = [
    'talib', 'ta-lib', 'TA_Lib',
    'MA(', 'EMA(', 'SMA(', 'RSI(', 'MACD(', 
    'KDJ(', 'BOLL(', 'ATR(', 'DMI(', 'ADX('
]
```

### 违反后果

- 立即回滚代码
- 相关设计文档重新评审
- 记录到技术债务台账

---

## 铁律二：情绪优先

### 核心约束

所有分析算法**必须基于情绪因子**，而非技术指标。

### 适用范围（MSS / IRS / PAS）

- MSS / IRS / PAS 三算法必须以情绪因子为共同输入
- MSS / IRS / PAS 三算法**同权协同**，集成层不得偏废或以单算法硬否决
- 三算法集成时保持情绪口径一致

### 情绪因子来源

| 来源 | 因子示例 |
|------|----------|
| 市场广度 | 上涨/下跌股票比例 |
| 极端情绪 | 涨停/跌停数量与占比 |
| 资金流向 | 成交量变化、北向资金 |
| 波动特征 | 日内波动率、换手率 |

### 设计评审检查点

- 每个算法设计必须说明情绪因子来源
- 禁止使用技术指标作为情绪代理
- MSS / IRS / PAS 三算法情绪口径一致，集成层不得偏废
- 任何“门控/约束”必须为协同约束或风险上限，不得出现单点否决

---

## 铁律三：本地数据优先

### 核心约束

系统运行必须**优先使用本地数据库与本地存储的数据**，外部数据源仅用于离线更新或缺口补全，且须先落库/缓存后进入主流程。

### 配置要求

- 数据路径必须通过环境变量或配置注入（`DATA_PATH`、`DUCKDB_DIR`、`CACHE_PATH`、`LOG_PATH`）
- 本地数据根目录由 `DATA_PATH` 统一指向（如 `${DATA_PATH}`）

### 缺口处理原则

- 缺失数据触发离线补采/补全任务
- 冷启动或紧急补拉必须先落库/缓存并记录来源
- 允许使用“上次可用数据”降级，但必须标记质量状态与来源
- 主流程不得以远端实时查询作为常态依赖

### 设计评审检查点

- 明确数据更新与读取路径，禁止主流程依赖远端实时查询
- 本地数据库/文件存储为默认读取来源
- 缺口补全与落库流程需在设计中明确

---

## 铁律四：路径硬编码绝对禁止

### 核心约束

所有路径、密钥与配置**必须通过环境变量或配置注入**，不得在代码或配置中硬编码。

### 禁止行为

- 任何绝对路径硬编码（如 `C:\`, `D:\`, `G:\`, `/home/`, `/Users/`）
- 任何相对路径硬编码（如 `data/`, `cache/`, `logs/`）
- 在代码中直接写入密钥、Token 或私有连接串

### 必须方式

- 使用 `Config.from_env()` / 环境变量读取路径与密钥
- 统一使用 `DATA_PATH` / `DUCKDB_DIR` / `CACHE_PATH` / `LOG_PATH`

### 设计评审检查点

- 代码与文档示例不得出现硬编码路径
- 运行时路径必须来自配置层

---

## 铁律五：A 股专属

### 核心约束

系统**仅支持中国 A 股市场**（上交所、深交所），所有算法与流程必须遵守 A 股规则。

### 必备规则

- T+1 交割与交易时间窗口
- 涨跌停限制（主板 10%、创业板/科创板 20%、ST 5%）
- 申万 31 行业体系

### 设计评审检查点

- 输入数据源必须为 A 股标的
- 回测/交易规则必须符合 A 股规则手册

---

## 执行机制

### 自动检查

| 检查点 | 工具 | 触发时机 |
|--------|------|----------|
| 技术指标 | pre-commit hook | 代码提交前 |
| 数据路径 | 路径硬编码扫描 | 代码提交前 |

### 人工检查

| 检查点 | 责任人 | 触发时机 |
|--------|--------|----------|
| 情绪因子来源 | 设计评审 | A3阶段 |
| 数据来源路径 | 设计评审 | A3阶段 |
| A 股规则合规 | 设计评审 | A3阶段 |
| 算法合规性 | 代码审查 | A6阶段 |

### 违规处理

| 违规类型 | 严重等级 | 处理方式 |
|----------|----------|----------|
| 使用技术指标 | 最严重 | 立即阻断，代码回滚 |
| 绕过本地数据 | 严重 | 阻断，必须修正 |
| 硬编码路径/密钥 | 严重 | 阻断，必须修正 |
| 违反 A 股规则 | 严重 | 阻断，必须修正 |
| 情绪因子不明 | 中等 | 警告，限期修正 |

---

## 与设计文档的关系

### 上游依赖

- `Governance/Capability/` - 定义阶段目标
- `Governance/steering/CORE-PRINCIPLES.md` - 执行约束

### 平行协同

- `docs/system-overview.md` - 系统总览与架构
- `docs/design/core-algorithms/` - 算法设计

### 下游落地

- 各Phase设计文档必须显式声明遵守系统铁律
- 代码实现必须通过自动检查

---

## 变更记录

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v3.3.0 | 2026-02-05 | 新增铁律：路径硬编码绝对禁止、A 股专属 |
| v3.2.0 | 2026-02-05 | 新增铁律：本地数据优先 |
| v3.1.0 | 2026-02-05 | 更名为系统铁律，保留前两条铁律 |
| v3.0.2 | 2026-02-04 | 文档对齐与重复引用清理 |
| v3.0.1 | 2026-02-03 | 与 CORE-PRINCIPLES 门控分级保持一致 |
| v3.0.0 | 2026-01-31 | 重构版：与 docs/ 设计文档对齐 |
| v2.1.0 | 2026-01-23 | v2.1设计集收口 |
| v2.0.0 | 2026-01-21 | v2.0重大升级 |

---

**关联文档**：
- 核心原则：[CORE-PRINCIPLES.md](./CORE-PRINCIPLES.md)
- 系统架构：[../../docs/system-overview.md](../../docs/system-overview.md)

